<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è²¸æ¬¾æ™ºæ…§åˆ†æç³»çµ± v9</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f5f7fb;
      --card-bg: #ffffff;
      --primary: #4c6fff;
      --primary-soft: #e4ebff;
      --accent: #ffb857;
      --danger: #ff5b5b;
      --muted: #6b7280;
      --border: #e2e8f0;
      --success: #22c55e;
      --warning: #f97316;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.08);
      --radius-lg: 18px;
      --radius-md: 12px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", system-ui, sans-serif;
      background: radial-gradient(circle at top left, #e0e7ff 0, #f5f7fb 40%, #fdfdfd 100%);
      color: #111827;
    }

    #app {
      max-width: 1280px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
    }

    .logo {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 22px;
      letter-spacing: 0.03em;
    }

    .logo-badge {
      width: 32px;
      height: 32px;
      border-radius: 12px;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 800;
      font-size: 18px;
      box-shadow: 0 8px 20px rgba(79, 70, 229, 0.45);
    }

    .subtitle {
      font-size: 13px;
      color: var(--muted);
      margin-top: 4px;
    }

    .tag-version {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: #1d4ed8;
      font-weight: 600;
    }

    .tag-version span {
      display: inline-flex;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #1d4ed8;
      color: #fff;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.3fr);
      gap: 20px;
    }

    @media (max-width: 960px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius-lg);
      padding: 18px 18px 16px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.22);
      backdrop-filter: blur(8px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title-badge {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: var(--primary-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #1d4ed8;
      font-size: 13px;
      font-weight: 700;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f9fafb;
      color: var(--muted);
      border: 1px dashed #e5e7eb;
    }

    .chip-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px 12px;
      margin-bottom: 6px;
    }

    .form-row-full {
      grid-column: 1 / -1;
    }

    @media (max-width: 640px) {
      .form-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: #4b5563;
      margin-bottom: 4px;
    }

    input[type="number"],
    input[type="text"],
    select,
    textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      font-size: 13px;
      outline: none;
      transition: 0.15s border, 0.15s box-shadow, 0.15s background;
      resize: vertical;
    }

    input[type="number"]:focus,
    input[type="text"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.35);
      background: #fff;
    }

    .inline-checks {
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      font-size: 12px;
      color: var(--muted);
    }

    .inline-checks label {
      display: inline-flex;
      align-items: center;
      margin: 0;
      gap: 4px;
      cursor: pointer;
    }

    .inline-checks input[type="checkbox"],
    .inline-checks input[type="radio"] {
      width: 13px;
      height: 13px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.15s transform, 0.15s box-shadow, 0.15s background, 0.15s color;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #fff;
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.45);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(79, 70, 229, 0.55);
    }

    .btn-outline {
      background: #f9fafb;
      color: #4b5563;
      border: 1px solid #e5e7eb;
    }

    .btn-outline:hover {
      background: #edf2ff;
      color: #1d4ed8;
      border-color: #c7d2fe;
    }

    .btn-sub {
      background: #fef9c3;
      color: #92400e;
      border: 1px solid #facc15;
    }

    .btn-sub:hover {
      background: #fef3c7;
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    .divider {
      height: 1px;
      background: linear-gradient(to right, #e5e7eb, rgba(229, 231, 235, 0));
      margin: 12px 0 10px;
    }

    .sub-card {
      border-radius: var(--radius-md);
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      margin-top: 10px;
      background: #f8fafc;
    }

    .sub-card h4 {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      margin: 0 0 8px;
    }

    .sub-tag {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .calc-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 12px;
    }

    .calc-result {
      margin-top: 6px;
      font-size: 12px;
      color: #111827;
      padding: 6px 8px;
      border-radius: 10px;
      background: #eef2ff;
      border: 1px dashed #c7d2fe;
    }

    .calc-result strong {
      color: #1d4ed8;
    }

    @media (max-width: 640px) {
      .calc-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .pill-tabs {
      display: inline-flex;
      gap: 8px;
      background: #f3f4f6;
      padding: 4px;
      border-radius: 999px;
    }

    .pill-tab {
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      border: none;
      background: transparent;
      color: #6b7280;
      font-weight: 500;
    }

    .pill-tab.active {
      background: #fff;
      color: #111827;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    .project-list {
      margin-top: 6px;
      max-height: 560px;
      overflow: auto;
      padding-right: 4px;
    }

    .project-card {
      border-radius: var(--radius-md);
      border: 1px solid #e5e7eb;
      padding: 10px 11px 9px;
      background: #ffffff;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 6px 12px;
      margin-bottom: 8px;
    }

    @media (max-width: 640px) {
      .project-card {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .project-main-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .project-company {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: var(--muted);
    }

    .badge-company {
      padding: 2px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      font-size: 11px;
      font-weight: 600;
    }

    .badge-cat {
      padding: 2px 8px;
      border-radius: 999px;
      background: #fef3c7;
      color: #92400e;
      font-size: 11px;
      font-weight: 600;
    }

    .badge-level {
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10px;
      background: #e0f2fe;
      color: #0369a1;
    }

    .badge-best {
      padding: 2px 8px;
      border-radius: 999px;
      background: #dcfce7;
      color: #15803d;
      font-size: 11px;
      margin-left: 4px;
    }

    .project-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .project-tag {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #f3f4f6;
      color: #4b5563;
    }

    .project-desc {
      font-size: 11px;
      color: #4b5563;
      line-height: 1.45;
    }

    .project-meta {
      font-size: 11px;
      color: #6b7280;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      justify-content: flex-end;
      align-items: center;
    }

    .dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: #9ca3af;
    }

    .empty {
      font-size: 12px;
      color: var(--muted);
      padding: 8px 10px;
      background: #f9fafb;
      border-radius: 10px;
      border: 1px dashed #e5e7eb;
      margin-top: 6px;
    }

    .score-chip {
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
      font-size: 11px;
    }

    .score-chip.bad {
      background: #fee2e2;
      color: #b91c1c;
    }

    .case-item-btn {
      width: 100%;
      justify-content: space-between;
      margin-top: 6px;
      font-size: 12px;
      padding: 6px 10px;
    }

    .case-item-meta {
      font-size: 11px;
      color: #9ca3af;
    }

    footer {
      margin-top: 18px;
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
    }

    details summary {
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      padding: 6px 0;
    }

    details summary::-webkit-details-marker {
      display: none;
    }

    details summary::before {
      content: "â–¶";
      display: inline-block;
      font-size: 10px;
      margin-right: 6px;
      transform: translateY(-1px);
      color: #6b7280;
    }

    details[open] summary::before {
      content: "â–¼";
    }

    ul.memo-list {
      margin: 4px 0 0 18px;
      padding: 0;
      font-size: 12px;
      color: #4b5563;
    }

    ul.memo-list li {
      margin-bottom: 3px;
    }
  </style>
</head>
<body>
<div id="app">
  <header>
    <div>
      <div class="logo">
        <span class="logo-badge">L</span>
        <div>
          è²¸æ¬¾æ™ºæ…§åˆ†æç³»çµ±
          <div class="subtitle">
            ä¸€æ¬¡è¼¸å…¥å®¢æˆ¶æ¢ä»¶ âœ AI è‡ªå‹•é…å°æˆ¿è²¸ / ä¿¡è²¸ / æ‰‹æ©Ÿ / è»Šè²¸ / ä¸‰èƒå°ˆæ¡ˆï¼Œä¸¦æä¾›å„ç¨®æœˆä»˜ / åˆ°æ‰‹é‡‘é¡è©¦ç®—
          </div>
        </div>
      </div>
    </div>
    <div class="tag-version">
      <span>v9</span> æ–°å¢æ‘˜è¦è©±è¡“ / åˆ°æ‰‹é‡‘é¡ / æš«å­˜æ¡ˆä»¶ / çµ„åˆç­–ç•¥
    </div>
  </header>

  <div class="layout">
    <!-- å·¦å´ï¼šè¡¨å–®èˆ‡è©¦ç®— -->
    <section class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="card-title-badge">1</span>
          å®¢æˆ¶æ¢ä»¶ï¼ˆAI æ™ºèƒ½æ¨è–¦ï¼‰
        </div>
        <div class="chip">
          <span class="chip-dot"></span> è³‡æ–™è¶Šå®Œæ•´ï¼Œæ¨è–¦è¶Šç²¾æº–
        </div>
      </div>

      <div class="form-grid">
        <div class="form-row-full">
          <label>å®¢æˆ¶ç¨±å‘¼ï¼ˆé¸å¡«ï¼‰</label>
          <input type="text" id="custName" placeholder="ä¾‹å¦‚ ç‹å…ˆç”Ÿ / é™³å°å§" />
        </div>

        <div>
          <label>å¹´é½¡</label>
          <input type="number" id="age" min="18" max="80" placeholder="ä¾‹å¦‚ 35" value="30" />
        </div>
        <div>
          <label>æœˆæ”¶å…¥ï¼ˆå…ƒï¼‰</label>
          <input type="number" id="income" min="0" step="1000" placeholder="ä¾‹å¦‚ 42000" value="42000" />
        </div>

        <div>
          <label>æ¬²è²¸é‡‘é¡ï¼ˆå…ƒï¼‰</label>
          <input type="number" id="loanAmount" min="0" step="10000" placeholder="ä¾‹å¦‚ 400000" value="400000" />
        </div>
        <div>
          <label>ç›®å‰è² å‚µ / æœˆä»˜ç¸½é¡ï¼ˆå…ƒï¼‰</label>
          <input type="number" id="debtMonthly" min="0" step="1000" placeholder="åŒ…å«æˆ¿è²¸ / ä¿¡è²¸ / è»Šè²¸ç­‰" />
        </div>

        <div class="form-row-full">
          <label>è³‡ç”¢ / æŠµæŠ¼æ¢ä»¶</label>
          <div class="inline-checks">
            <label><input type="radio" name="asset" value="none" checked /> ç„¡æˆ¿ç„¡è»Š</label>
            <label><input type="radio" name="asset" value="car" /> åä¸‹æœ‰æ±½è»Š</label>
            <label><input type="radio" name="asset" value="bike" /> åä¸‹æœ‰æ©Ÿè»Š</label>
            <label><input type="radio" name="asset" value="house" /> åä¸‹æœ‰æˆ¿å±‹</label>
          </div>
        </div>

        <div class="form-row-full">
          <label>ä¿¡ç”¨ç‹€æ³ï¼ˆå¯è¤‡é¸ï¼‰</label>
          <div class="inline-checks">
            <label><input type="checkbox" id="creditNormal" checked /> æ­£å¸¸ç¹³æ¬¾</label>
            <label><input type="checkbox" id="creditDelay" /> æ›¾æœ‰é²ç¹³</label>
            <label><input type="checkbox" id="creditBad" /> æœ‰å¼·åœ / å‘†å¸³</label>
          </div>
        </div>

        <div class="form-row-full">
          <label>åªé¡¯ç¤ºå“ªäº›å…¬å¸å°ˆæ¡ˆï¼Ÿï¼ˆç©ºç™½ä»£è¡¨å…¨éƒ¨ï¼‰</label>
          <div class="inline-checks">
            <label><input type="checkbox" class="companyFilter" value="æ–°é‘«" /> æ–°é‘«</label>
            <label><input type="checkbox" class="companyFilter" value="é¼ä¿¡" /> é¼ä¿¡</label>
            <label><input type="checkbox" class="companyFilter" value="å’Œæ½¤" /> å’Œæ½¤</label>
            <label><input type="checkbox" class="companyFilter" value="èæ˜“" /> èæ˜“</label>
            <label><input type="checkbox" class="companyFilter" value="äºå¤ª" /> äºå¤ª</label>
            <label><input type="checkbox" class="companyFilter" value="TAC" /> TAC</label>
          </div>
        </div>

        <div class="form-row-full">
          <label>å¸Œæœ›çš„è²¸æ¬¾å¤§åˆ†é¡</label>
          <div class="inline-checks">
            <label><input type="checkbox" class="wantType" value="æˆ¿è²¸" checked /> æˆ¿è²¸</label>
            <label><input type="checkbox" class="wantType" value="ä¿¡è²¸" checked /> ä¿¡è²¸</label>
            <label><input type="checkbox" class="wantType" value="æ±½è»Š" checked /> æ±½è»Š</label>
            <label><input type="checkbox" class="wantType" value="æ©Ÿè»Š" /> æ©Ÿè»Š</label>
            <label><input type="checkbox" class="wantType" value="æ‰‹æ©Ÿ" /> æ‰‹æ©Ÿ</label>
          </div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="btnRecommend">
          ğŸ” ç”¢ç”Ÿ AI æ¨è–¦
        </button>
        <button class="btn-outline" id="btnClear">
          ğŸ§½ æ¸…ç©ºæ¢ä»¶
        </button>
      </div>
      <div class="hint">
        â€» ç³»çµ±ä¸æœƒå–ä»£æˆä¿¡å¯©æ ¸ï¼Œåªå”åŠ©ä½ å¿«é€Ÿéæ¿¾ã€Œæ¯”è¼ƒé©åˆå“ªå¹¾å€‹å°ˆæ¡ˆã€ä¾›ä½ å°ˆæ¥­åˆ¤æ–·ã€‚
      </div>

      <div class="divider"></div>

      <!-- å¿«é€Ÿè©¦ç®—å€ -->
      <div class="card-header" style="margin-bottom: 6px;">
        <div class="card-title">
          <span class="card-title-badge">2</span>
          å¿«é€Ÿè©¦ç®—ï¼ˆå¤šå·¥å…·ï¼‰
        </div>
        <span class="chip">å¹¾åˆ† / å¹´åˆ©ç‡ / åˆ°æ‰‹é‡‘é¡ / ç´”åˆ©æ¯ï¼Œä¸€æ¬¡ç®—å¥½</span>
      </div>

      <!-- ç­‰é¡æœ¬æ¯ -->
      <div class="sub-card">
        <h4>
          ç­‰é¡æœ¬æ¯æœˆä»˜è©¦ç®—
          <span class="sub-tag">é©ç”¨æˆ¿è²¸ / ä¿¡è²¸ / åˆ†æœŸ</span>
        </h4>
        <div class="calc-grid">
          <div>
            <label>è²¸æ¬¾é‡‘é¡ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="eqLoan" value="300000" />
          </div>
          <div>
            <label>å¹´åˆ©ç‡ï¼ˆ%ï¼‰</label>
            <input type="number" id="eqRate" value="8" step="0.1" />
          </div>
          <div>
            <label>æœŸæ•¸ï¼ˆæœˆï¼‰</label>
            <input type="number" id="eqMonths" value="36" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <button class="btn-sub" id="btnEqCalc">è¨ˆç®—æœˆä»˜</button>
          </div>
        </div>
        <div class="calc-result" id="eqResult">
          ç›®å‰å°šæœªè©¦ç®—ã€‚
        </div>
      </div>

      <!-- æˆ¿è²¸æˆæ•¸ + äºŒèƒé¡åº¦ -->
      <div class="sub-card">
        <h4>
          æˆ¿è²¸æˆæ•¸ + äºŒèƒå¯è²¸é¡åº¦è©¦ç®—
          <span class="sub-tag">å¿«é€ŸæŠ“ã€Œé‚„èƒ½åšå¤šå°‘äºŒèƒã€</span>
        </h4>
        <div class="calc-grid">
          <div>
            <label>æˆ¿å±‹å¸‚åƒ¹ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="housePrice" placeholder="ä¾‹å¦‚ 800 è¬å¡« 8000000" />
          </div>
          <div>
            <label>ç¾æœ‰ç¬¬ä¸€èƒé¤˜é¡ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="firstMortgage" placeholder="ç›®å‰éŠ€è¡Œé¤˜é¡" />
          </div>
          <div>
            <label>å¯æ¥å—æœ€é«˜ç¸½æˆæ•¸ï¼ˆ%ï¼‰</label>
            <input type="number" id="maxLtv" value="80" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <button class="btn-sub" id="btnSecondCalc">è¨ˆç®—å¯è²¸äºŒèƒ</button>
          </div>
        </div>
        <div class="calc-result" id="secondResult">
          ç›®å‰å°šæœªè©¦ç®—ã€‚
        </div>
      </div>

      <!-- å¹¾åˆ†è©¦ç®— -->
      <div class="sub-card">
        <h4>
          å¹¾åˆ†è©¦ç®—ï¼ˆæ°‘é–“ / ä»£æ›¸ç”¨ï¼‰
          <span class="sub-tag">ä¸ç”¨æ›ç®—åˆ©ç‡ï¼Œç›´æ¥è¼¸å…¥å¹¾åˆ†</span>
        </h4>
        <div class="calc-grid">
          <div>
            <label>å€Ÿæ¬¾é‡‘é¡ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="fenAmount" value="100000" />
          </div>
          <div>
            <label>æœˆåˆ©æ¯å¹¾åˆ†</label>
            <select id="fenRate">
              <option value="1">1 åˆ†ï¼ˆ1%ï¼‰</option>
              <option value="1.5">1.5 åˆ†ï¼ˆ1.5%ï¼‰</option>
              <option value="2" selected>2 åˆ†ï¼ˆ2%ï¼‰</option>
              <option value="2.5">2.5 åˆ†ï¼ˆ2.5%ï¼‰</option>
              <option value="3">3 åˆ†ï¼ˆ3%ï¼‰</option>
              <option value="4">4 åˆ†ï¼ˆ4%ï¼‰</option>
              <option value="5">5 åˆ†ï¼ˆ5%ï¼‰</option>
            </select>
          </div>
          <div>
            <label>æœŸæ•¸ï¼ˆæœˆï¼‰</label>
            <input type="number" id="fenMonths" value="12" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <button class="btn-sub" id="btnFenCalc">è¨ˆç®—æœˆä»˜ï¼ˆæœ¬é‡‘å‡æ”¤ + å¹¾åˆ†åˆ©æ¯ï¼‰</button>
          </div>
        </div>
        <div class="calc-result" id="fenResult">
          å…¬å¼ï¼šç¸½é‡‘é¡ Ã· æœŸæ•¸ +ï¼ˆç¸½é‡‘é¡ Ã— å¹¾åˆ†ï¼‰ï¼ æ¯æœˆæ‡‰ç¹³é‡‘é¡ã€‚
        </div>
      </div>

      <!-- ç´”åˆ©æ¯è©¦ç®— -->
      <div class="sub-card">
        <h4>
          ç´”åˆ©æ¯æ”¤é‚„è©¦ç®—
          <span class="sub-tag">åªç¹³åˆ©æ¯ï¼Œä¸æ”¤é‚„æœ¬é‡‘</span>
        </h4>
        <div class="calc-grid">
          <div>
            <label>å€Ÿæ¬¾é‡‘é¡ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="ioAmount" value="200000" />
          </div>
          <div>
            <label>æœˆåˆ©ç‡ï¼ˆå¹¾åˆ† / %ï¼‰</label>
            <input type="number" id="ioRate" value="2" step="0.1" />
          </div>
          <div>
            <label>æœŸæ•¸ï¼ˆæœˆï¼‰</label>
            <input type="number" id="ioMonths" value="12" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <button class="btn-sub" id="btnIoCalc">è¨ˆç®—ç´”åˆ©æ¯</button>
          </div>
        </div>
        <div class="calc-result" id="ioResult">
          æ¯æœˆåªç¹³åˆ©æ¯ï¼ŒæœŸæœ«ä»éœ€ä¸€æ¬¡è™•ç†å…¨éƒ¨æœ¬é‡‘ã€‚
        </div>
      </div>

      <!-- åˆ°æ‰‹é‡‘é¡è©¦ç®— -->
      <div class="sub-card">
        <h4>
          åˆ°æ‰‹é‡‘é¡è©¦ç®—
          <span class="sub-tag">æ ¸å‡†é‡‘é¡æ‰£æ‰ä»£å„Ÿ / å„ç¨®è²»ç”¨</span>
        </h4>
        <div class="calc-grid">
          <div>
            <label>æ ¸å‡†é‡‘é¡ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="netApprove" placeholder="ä¾‹å¦‚ 300000" />
          </div>
          <div>
            <label>ä»£å„Ÿé‡‘é¡ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="netPayoff" placeholder="ä¾‹å¦‚ 120000" />
          </div>
          <div>
            <label>æœå‹™è²» / ä»£æ›¸è²»ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="netService" placeholder="ä¾‹å¦‚ 15000" />
          </div>
          <div>
            <label>å…¶ä»–é›œè²»ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="netOther" placeholder="ä¾‹å¦‚ 5000" />
          </div>
        </div>
        <div class="btn-row" style="margin-top:8px;">
          <button class="btn-sub" id="btnNetCalc">è¨ˆç®—å¯¦éš›åˆ°æ‰‹</button>
        </div>
        <div class="calc-result" id="netResult">
          å¹«å®¢æˆ¶ç®—ã€Œå¯¦éš›å…¥è¢‹ã€å¤šå°‘ï¼Œæ–¹ä¾¿è·Ÿä»–èªªæ˜ã€‚
        </div>
      </div>

      <!-- ä¿¡ç”¨åˆ†æ•¸ -->
      <div class="sub-card">
        <h4>
          ä¿¡ç”¨è²¸æ¬¾å¯©æ ¸åˆ†æ•¸é ä¼°ï¼ˆç°¡æ˜“ï¼‰
          <span class="sub-tag">åƒ…ä¾›åƒè€ƒï¼Œä¸ä»£è¡¨éŠ€è¡Œå¯¦éš›å¯©æ ¸</span>
        </h4>
        <div class="calc-grid">
          <div>
            <label>åœ¨è·å¹´è³‡ï¼ˆå¹´ï¼‰</label>
            <input type="number" id="scYear" value="2" />
          </div>
          <div>
            <label>ä¿¡ç”¨å¡ / è²¸æ¬¾é²ç¹³ç´€éŒ„</label>
            <select id="scDelay">
              <option value="0">å®Œå…¨æ²’æœ‰</option>
              <option value="1">å¶çˆ¾ 1~2 æ¬¡</option>
              <option value="2">å¸¸æ…‹ / å¼·åœ</option>
            </select>
          </div>
          <div>
            <label>è² å‚µæ¯”ï¼ˆæ¯æœˆæœˆä»˜ Ã· æœˆæ”¶å…¥ %ï¼‰</label>
            <input type="number" id="scDebtRatio" value="30" />
          </div>
          <div>
            <label>æ˜¯å¦æœ‰æˆ¿ / è»Šæ“”ä¿</label>
            <select id="scAsset">
              <option value="0">ç„¡æ“”ä¿</option>
              <option value="10">åªæœ‰æ©Ÿè»Šæˆ–å°è»Š</option>
              <option value="20">æœ‰è‡ªç”¨ä½å®…</option>
            </select>
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <button class="btn-sub" id="btnScore">é ä¼°ä¿¡ç”¨åˆ†æ•¸</button>
          </div>
        </div>
        <div class="calc-result" id="scoreResult">
          åˆ†æ•¸ç¯„åœ 0~100ï¼Œåƒ…ä½œç‚ºä½ è©•ä¼°å®¢æˆ¶é«”è³ªçš„åƒè€ƒå·¥å…·ã€‚
        </div>
      </div>

      <!-- æ–‡å­—æ‘˜è¦ / è©±è¡“ -->
      <div class="sub-card">
        <h4>
          æ–‡å­—æ‘˜è¦ / è©±è¡“
          <span class="sub-tag">ä¸€éµç”¢ç”Ÿï¼Œå¯ç›´æ¥è²¼çµ¦å®¢æˆ¶</span>
        </h4>
        <div class="btn-row" style="margin-bottom:6px;">
          <button class="btn-sub" id="btnSummary">ç”¢ç”Ÿæ‘˜è¦</button>
          <button class="btn-outline" id="btnCopySummary">è¤‡è£½æ–‡å­—</button>
        </div>
        <textarea id="summaryText" rows="4" placeholder="æŒ‰ä¸‹ã€Œç”¢ç”Ÿæ‘˜è¦ã€å¾Œï¼Œé€™è£¡æœƒè‡ªå‹•ç”¢ç”Ÿæ–‡å­—å…§å®¹ï¼Œé©åˆè²¼åˆ° Line æˆ–å‚™è¨»ã€‚"></textarea>
        <div class="hint">
          æ–‡å­—æœƒä¾ç…§å¹´é½¡ / æ”¶å…¥ / è³‡ç”¢ / è² å‚µæ¯” / ä¿¡ç”¨ç‹€æ³ï¼Œè‡ªå‹•ç”¢ç”Ÿä¸€æ®µèªªæ˜èˆ‡å»ºè­°æ–¹å‘ã€‚
        </div>
      </div>

      <!-- æ¡ˆä»¶æš«å­˜æ¸…å–® -->
      <div class="sub-card">
        <h4>
          æ¡ˆä»¶æš«å­˜æ¸…å–®
          <span class="sub-tag">åªå­˜é€™å°è£ç½®ï¼Œä¸æœƒä¸Šå‚³</span>
        </h4>
        <div class="calc-grid">
          <div>
            <label>å®¢æˆ¶ä»£è™Ÿ / åç¨±</label>
            <input type="text" id="caseLabel" placeholder="ä¾‹å¦‚ ç‹å…ˆç”Ÿ-æˆ¿äºŒèƒ" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <button class="btn-sub" id="btnSaveCase">åŠ å…¥æš«å­˜</button>
            <button class="btn-outline" id="btnClearCases">æ¸…ç©ºæš«å­˜</button>
          </div>
        </div>
        <div class="hint">
          é»é¸ä¸‹æ–¹æ¡ˆä»¶å³å¯è¼‰å…¥ç•¶æ™‚çš„æ¢ä»¶ï¼ˆä¸å«è©¦ç®—çµæœï¼‰ã€‚è³‡æ–™åªå­˜åœ¨ç€è¦½å™¨ localStorageã€‚
        </div>
        <div id="caseList" class="empty">
          ç›®å‰æ²’æœ‰æš«å­˜æ¡ˆä»¶ã€‚
        </div>
      </div>

      <footer>
        â€» æœ¬ç³»çµ±åƒ…å”åŠ©ä½ å¿«é€Ÿæ•´ç†å°ˆæ¡ˆèˆ‡è©¦ç®—é‡‘é¡ï¼Œå¯¦éš›æ ¸æº–æ¢ä»¶ä»¥å„éŠ€è¡Œ / é‡‘èå…¬å¸ç‚ºæº–ã€‚
      </footer>
    </section>

    <!-- å³å´ï¼šAI æ¨è–¦çµæœ -->
    <section class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="card-title-badge">3</span>
          AI æ¨è–¦çµæœèˆ‡æ‰€æœ‰å°ˆæ¡ˆ
        </div>
        <div class="pill-tabs">
          <button class="pill-tab active" data-tab="best">æœ€é©åˆæ¢ä»¶</button>
          <button class="pill-tab" data-tab="alt">å¯å‚™é¸æ–¹æ¡ˆ</button>
          <button class="pill-tab" data-tab="all">å…¨éƒ¨å°ˆæ¡ˆåˆ—è¡¨</button>
        </div>
      </div>
      <div class="hint">
        å…ˆè¼¸å…¥å·¦å´æ¢ä»¶ä¸¦æŒ‰ã€Œç”¢ç”Ÿ AI æ¨è–¦ã€ï¼Œç³»çµ±æœƒä¾å¹´é½¡ / è³‡ç”¢ / ä¿¡ç”¨ç‹€æ³ / éœ€æ±‚åˆ†é¡ï¼Œæ›¿ä½ æ’å‡ºé©åˆåº¦ã€‚
      </div>

      <!-- çµ„åˆç­–ç•¥å»ºè­° -->
      <div class="sub-card" id="strategyBox">
        å°šæœªç”¢ç”Ÿçµ„åˆç­–ç•¥å»ºè­°ï¼Œè«‹å…ˆç”¢ç”Ÿ AI æ¨è–¦ã€‚
      </div>

      <div class="project-list" id="projectList">
        <div class="empty">
          å°šæœªç”¢ç”Ÿçµæœï¼Œè«‹å…ˆè¼¸å…¥æ¢ä»¶ä¸¦æŒ‰ä¸‹ã€ŒğŸ” ç”¢ç”Ÿ AI æ¨è–¦ã€ã€‚
        </div>
      </div>
    </section>
  </div>

  <!-- å…¬å¸æ‰‹å†Šé€ŸæŸ¥ -->
  <section class="card" style="margin-top:18px;">
    <div class="card-header">
      <div class="card-title">
        <span class="card-title-badge">4</span>
        å…¬å¸æ‰‹å†Šé€ŸæŸ¥ï¼ˆå‚™å¿˜éŒ„ï¼‰
      </div>
      <span class="chip">ä»¥ä¸‹å…§å®¹å¯ä¾ä½ å¯¦å‹™ç¶“é©—è‡ªè¡Œä¿®æ”¹</span>
    </div>
    <div class="hint">
      é€™è£¡åªæ˜¯ä¸€å€‹ä½ è‡ªå·±çš„é‡é»æ‘˜è¦å€ï¼Œä¸æ˜¯å®˜æ–¹è¦å‰‡ã€‚å»ºè­°ä¾ç…§ä½ æ‰‹ä¸Šçš„ PDF / å…¬å‘Šæ…¢æ…¢è£œä¸Šã€‚
    </div>

    <details>
      <summary>å’Œæ½¤ï¼ˆæˆ¿è²¸ / è»Šè²¸ï¼‰</summary>
      <ul class="memo-list">
        <li>æˆ¿è²¸äºŒèƒï¼šå¸¸è¦‹æœ€é«˜ç¸½æˆæ•¸ç´„ 8 æˆä¸Šä¸‹ï¼Œå¯¦å‹™çœ‹ç‰©ä»¶èˆ‡åœ°æ®µã€‚</li>
        <li>å°è–ªè½‰ç©©å®šã€å¹´è³‡è¼ƒé•·å®¢æˆ¶è¼ƒå‹å–„ï¼Œä¿¡ç”¨ç‘•ç–µéœ€å€‹æ¡ˆè©•ä¼°ã€‚</li>
        <li>è»Šè²¸éƒ¨åˆ†ï¼šè»Šé½¡ / è»Šç¨®å½±éŸ¿æˆæ•¸èˆ‡åˆ©ç‡ï¼Œéœ€æ­é…è¡Œç…§èˆ‡ä¼°åƒ¹ã€‚</li>
      </ul>
    </details>

    <details>
      <summary>é¼ä¿¡ï¼ˆåé‚Šè²¸ / ç‰¹æ®Šç‰©ä»¶ï¼‰</summary>
      <ul class="memo-list">
        <li>å¯åšä¸€èˆ¬éŠ€è¡Œè¼ƒä¸å–œæ­¡çš„ç‰©ä»¶ï¼Œä¾‹å¦‚ï¼šè¾²åœ°ã€åŸæ°‘åœ°ã€æ¼å¡­ã€å‡ºç§Ÿå¥—æˆ¿ç­‰ã€‚</li>
        <li>é©åˆä¿¡ç”¨é«”è³ªè¼ƒå¼±ã€ä½†ç‰©ä»¶æ¢ä»¶æœ‰åƒ¹å€¼çš„å®¢æˆ¶ã€‚</li>
        <li>åˆ©ç‡èˆ‡è²»ç”¨ç›¸å°åé«˜ï¼Œèªªæ˜æ™‚éœ€å¼·èª¿é¢¨éšªèˆ‡é‚„æ¬¾èƒ½åŠ›ã€‚</li>
      </ul>
    </details>

    <details>
      <summary>äºå¤ªï¼ˆæ‰‹æ©Ÿ / æ©Ÿè»Šå°ˆæ¡ˆï¼‰</summary>
      <ul class="memo-list">
        <li>æ‰‹æ©Ÿå°ˆæ¡ˆï¼šéœ€ç¬¦åˆæŒ‡å®šæ©Ÿå‹èˆ‡é›»ä¿¡æ–¹æ¡ˆï¼Œé©åˆå°é¡å‘¨è½‰ã€‚</li>
        <li>æ©Ÿè»Šå°ˆæ¡ˆï¼šçœ‹è»Šé½¡ã€æŒæœ‰æ™‚é–“èˆ‡æ˜¯å¦æœ‰èˆŠè²¸å¯ä»£å„Ÿã€‚</li>
        <li>å¸¸æ­é…è·æ¥­å·¥æœƒ / å‹ä¿è³‡æ–™ï¼Œåˆ©ç‡èˆ‡é¡åº¦ä¾å¯¦éš›å…¬å‘Šç‚ºæº–ã€‚</li>
      </ul>
    </details>

    <details>
      <summary>TAC / èæ˜“ï¼ˆæ±½æ©Ÿè»ŠåŸèï¼‰</summary>
      <ul class="memo-list">
        <li>è»Šå­ / æ©Ÿè»Šå·²ç¹³ä¸€æ®µæ™‚é–“ï¼Œå¯å†èè³‡ä¸€è¼ªæ‹¿å‡ºç¾é‡‘ã€‚</li>
        <li>æœƒçœ‹æŒæœ‰æ™‚é–“ã€é‡Œç¨‹æ•¸èˆ‡è»Šæ³ï¼ŒåŠå®¢æˆ¶ä¿¡ç”¨ç‹€æ³ã€‚</li>
        <li>å¯æ­é…æ•´åˆé«˜åˆ©è²¸æ¬¾ï¼Œé™ä½æ•´é«”æœˆä»˜å£“åŠ›ã€‚</li>
      </ul>
    </details>

    <details>
      <summary>ä½ è‡ªå·±çš„å‚™å¿˜éŒ„ï¼ˆå¯è‡ªç”±å¢ä¿®ï¼‰</summary>
      <ul class="memo-list">
        <li>åœ¨é€™è£¡è¨˜éŒ„ï¼šå“ªé–“å…¬å¸æœ€è¿‘æ”¶ä»¶æ¯”è¼ƒç©æ¥µã€å“ªå¹¾ç¨®æ¢ä»¶æœ€å¥½å…ˆé€å“ªè£¡ã€‚</li>
        <li>ä¹Ÿå¯ä»¥å¯«ï¼šæŸå…¬å¸é‡å°å“ªç¨®ç‘•ç–µï¼ˆé²ç¹³ã€åœå¡ï¼‰æ…‹åº¦å¦‚ä½•ã€‚</li>
        <li>æ­¤å€ç´”å‚™å¿˜ï¼Œä¸æœƒå½±éŸ¿ä¸Šé¢çš„è©¦ç®—èˆ‡ AI æ¨è–¦é‚è¼¯ã€‚</li>
      </ul>
    </details>
  </section>
</div>

<script>
  // ------------------------
  // å°ˆæ¡ˆè³‡æ–™ï¼ˆç¤ºç¯„ç‰ˆï¼‰
  // âš ï¸ ä½ å¯ä»¥æŠŠä¸‹é¢ projects é™£åˆ—æ›æˆä½  v4 / v7 è£¡ã€Œå®Œæ•´å°ˆæ¡ˆè¨­å®šã€
  //    çµæ§‹ç¶­æŒä¸€æ¨£å³å¯ï¼ŒAI æ¨è–¦æœƒè‡ªå‹•å¥—ç”¨ã€‚
  // ------------------------
  const projects = [
    {
      id: "TAC-CAR-01",
      company: "TAC",
      name: "TAC æ±½è»Šè¶… U å°ˆæ¡ˆ",
      category: "æ±½è»Š",
      type: "åˆ†æœŸ / åŸè",
      tags: ["æ­£å¸¸ä»¶", "æœ‰è»Šå¯åš", "æœŸæ•¸é•·"],
      creditLevel: "normal",
      minAge: 20,
      maxAge: 65,
      minIncome: 25000,
      needAsset: "car",
      maxLtv: 150,
      desc: "æ±½è»Šæ‹¿å»èè³‡ï¼Œä¿¡ç”¨æ­£å¸¸è€…æœˆä»˜è² æ“”è¼ƒè¼•ï¼Œé©åˆæœ‰è»Šæƒ³å‘¨è½‰ã€‚"
    },
    {
      id: "TAC-MOTO-01",
      company: "TAC",
      name: "TAC æ©Ÿè»ŠåŸèå°ˆæ¡ˆ",
      category: "æ©Ÿè»Š",
      type: "åŸè",
      tags: ["æ©Ÿè»ŠæŒæœ‰åŠå¹´ä»¥ä¸Š", "å¯ä»£å„ŸèˆŠä»¶"],
      creditLevel: "light",
      minAge: 20,
      maxAge: 60,
      minIncome: 22000,
      needAsset: "bike",
      maxLtv: 200,
      desc: "æ©Ÿè»Šåˆ†æœŸå·²ç¹³ä¸€æ®µæ™‚é–“ï¼Œé‚„æœ‰é¡åº¦å¯ä»¥å†å€Ÿå‡ºä¾†å‘¨è½‰ã€‚"
    },
    {
      id: "HEYU-HOUSE-02",
      company: "å’Œæ½¤",
      name: "å’Œæ½¤ æˆ¿å±‹äºŒèƒå‹ä¾¿åˆ©",
      category: "æˆ¿è²¸",
      type: "æˆ¿å±‹äºŒèƒ",
      tags: ["æœ€é«˜æˆæ•¸ 88 æˆ", "å¯æ­é…ä»£å„Ÿæ•´åˆ", "å¯æ¥è¼•ç‘•ç–µ"],
      creditLevel: "light",
      minAge: 20,
      maxAge: 75,
      minIncome: 30000,
      needAsset: "house",
      maxLtv: 88,
      desc: "åä¸‹æœ‰æˆ¿ã€ä½†éŠ€è¡Œä¸é¡˜å†è²¸æ™‚ï¼Œå¯è€ƒæ…®ä½¿ç”¨çš„æˆ¿å±‹äºŒèƒå°ˆæ¡ˆã€‚"
    },
    {
      id: "DINGXIN-HOUSE-01",
      company: "é¼ä¿¡",
      name: "é¼ä¿¡ åé‚Šè²¸ï¼ˆäºŒèƒï¼‰",
      category: "æˆ¿è²¸",
      type: "æˆ¿å±‹äºŒèƒ",
      tags: ["å¯åšåŸæ°‘åœ° / æ¼å¡­", "å¯åšå‡ºç§Ÿå¥—æˆ¿", "å¯æ¥æ•´åˆä»£å„Ÿ"],
      creditLevel: "heavy",
      minAge: 20,
      maxAge: 80,
      minIncome: 20000,
      needAsset: "house",
      maxLtv: 88,
      desc: "æ¢ä»¶åç¡¬çš„æˆ¿å±‹äºŒèƒï¼Œå°ç‰©ä»¶å½ˆæ€§è¼ƒå¤§ï¼Œé©åˆåœŸèã€åŸæ°‘åœ°ç­‰ç‰¹æ®Šç‰©ä»¶ã€‚"
    },
    {
      id: "EGOOD-CAR-01",
      company: "E-Good",
      name: "å„ªè³ªæ±½è»Šä¿¡è²¸å°ˆæ¡ˆ",
      category: "ä¿¡è²¸",
      type: "æ±½è»Šä¿¡è²¸",
      tags: ["è–ªè½‰æˆ¶", "æœ‰ä¿äººåŠ åˆ†", "åˆ©ç‡è¼ƒæ¼‚äº®"],
      creditLevel: "normal",
      minAge: 20,
      maxAge: 65,
      minIncome: 30000,
      needAsset: "none",
      maxLtv: 22,
      desc: "æœ‰å›ºå®šè–ªè½‰ã€å¹´è³‡ç©©å®šè€…ï¼Œé¡åº¦å¯æŠ“åˆ° 22 å€è–ªè³‡ï¼Œé©åˆåšè³‡é‡‘æ•´åˆã€‚"
    },
    {
      id: "MOBILE-01",
      company: "ç‘ªå‰PAY",
      name: "æ‰‹æ©Ÿè²¸æ¬¾å°ˆæ¡ˆ",
      category: "æ‰‹æ©Ÿ",
      type: "åˆ†æœŸ",
      tags: ["éœ€æ™ºæ…§å‹æ‰‹æ©Ÿ", "éœ€æ‹å•†å“èˆ‡ IMEI", "å°é¡å‘¨è½‰"],
      creditLevel: "light",
      minAge: 20,
      maxAge: 60,
      minIncome: 20000,
      needAsset: "none",
      maxLtv: 0,
      desc: "æœ‰æ™ºæ…§å‹æ‰‹æ©Ÿå³å¯ç”³è«‹ï¼Œå°é¡åˆ†æœŸå‘¨è½‰ï¼Œå°è³‡ç”¢è¦æ±‚è¼ƒä½ã€‚"
    }
  ];

  // -----------------------
  // å–å¾—å®¢æˆ¶æ¢ä»¶ï¼ˆçµ¦ AI æ¨è–¦ç”¨ï¼‰
  // -----------------------
  function getCustomer() {
    const age = Number(document.getElementById("age").value) || 0;
    const income = Number(document.getElementById("income").value) || 0;
    const loanAmount = Number(document.getElementById("loanAmount").value) || 0;
    const debtMonthly = Number(document.getElementById("debtMonthly").value) || 0;

    const asset = document.querySelector("input[name='asset']:checked")?.value || "none";

    const creditNormal = document.getElementById("creditNormal").checked;
    const creditDelay = document.getElementById("creditDelay").checked;
    const creditBad = document.getElementById("creditBad").checked;

    let creditLevel = "normal";
    if (creditBad) creditLevel = "heavy";
    else if (creditDelay) creditLevel = "light";

    const companyFilters = Array.from(document.querySelectorAll(".companyFilter:checked")).map(
      (c) => c.value
    );
    const wantTypes = Array.from(document.querySelectorAll(".wantType:checked")).map(
      (c) => c.value
    );

    const debtRatio = income > 0 ? (debtMonthly / income) * 100 : 0;

    return {
      age,
      income,
      loanAmount,
      debtMonthly,
      debtRatio,
      asset,
      creditLevel,
      creditNormal,
      creditDelay,
      creditBad,
      companyFilters,
      wantTypes
    };
  }

  // -----------------------
  // å°ˆæ¡ˆè©•åˆ†é‚è¼¯
  // -----------------------
  function scoreProject(c, p) {
    if (c.companyFilters.length && !c.companyFilters.includes(p.company)) return 0;
    if (c.wantTypes.length && !c.wantTypes.includes(p.category)) return 0;
    if (c.age && (c.age < p.minAge || c.age > p.maxAge)) return 0;
    if (p.minIncome && c.income && c.income < p.minIncome) return 0;

    if (p.needAsset === "house" && c.asset !== "house") return 0;
    if (p.needAsset === "car" && c.asset !== "car") return 0;
    if (p.needAsset === "bike" && c.asset !== "bike") return 0;

    let score = 50;

    if (c.creditLevel === "normal" && p.creditLevel === "normal") score += 15;
    if (c.creditLevel === "light" && p.creditLevel !== "heavy") score += 5;
    if (c.creditLevel === "heavy" && p.creditLevel === "heavy") score += 5;
    if (c.creditLevel === "heavy" && p.creditLevel === "normal") score -= 25;

    if (c.debtRatio > 70) score -= 25;
    else if (c.debtRatio > 50) score -= 10;
    else if (c.debtRatio < 30 && c.debtRatio > 0) score += 5;

    if (p.category === "ä¿¡è²¸" && c.loanAmount > c.income * 22) score -= 10;

    if (p.category === "æˆ¿è²¸" && c.asset === "house") score += 5;
    if (p.category === "æ±½è»Š" && c.asset === "car") score += 5;

    if (c.creditLevel === "heavy" && ["æ–°é‘«", "å’Œæ½¤", "E-Good"].includes(p.company)) {
      score -= 15;
    }

    return Math.max(score, 0);
  }

  // -----------------------
  // æ¸²æŸ“å°ˆæ¡ˆåˆ—è¡¨
  // -----------------------
  function renderProjects(list, mode = "best") {
    const container = document.getElementById("projectList");
    container.innerHTML = "";

    if (!list.length) {
      container.innerHTML =
        '<div class="empty">ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å°ˆæ¡ˆï¼Œå¯ä»¥èª¿æ•´ç¯©é¸æ¢ä»¶æˆ–æ”¹æˆã€Œå…¨éƒ¨å°ˆæ¡ˆåˆ—è¡¨ã€æŸ¥çœ‹ã€‚</div>';
      return;
    }

    list.forEach((p, idx) => {
      const isBest = mode === "best" && idx === 0 && p._score >= 60;
      const scoreText =
        p._score >= 75 ? "é©åˆåº¦é«˜" : p._score >= 60 ? "å¯è©•ä¼°" : p._score >= 40 ? "å‹‰å¼·å¯è«‡" : "æ¢ä»¶è¼ƒåƒåŠ›";
      const scoreClass = p._score >= 60 ? "" : "bad";

      const el = document.createElement("div");
      el.className = "project-card";
      el.innerHTML = `
        <div>
          <div class="project-main-title">
            ${p.name}
            <span class="badge-best" style="display:${isBest ? "inline-flex" : "none"};">ç³»çµ±é¦–é¸</span>
          </div>
          <div class="project-company">
            <span class="badge-company">${p.company}</span>
            <span class="badge-cat">${p.category}</span>
            <span class="badge-level">${p.type}</span>
          </div>
          <div class="project-tags">
            ${p.tags.map((t) => `<span class="project-tag">${t}</span>`).join("")}
          </div>
          <div class="project-desc" style="margin-top:4px;">
            ${p.desc}
          </div>
        </div>
        <div class="project-meta">
          <span>å¹´é½¡ ${p.minAge}~${p.maxAge}</span>
          <span class="dot"></span>
          <span>å»ºè­°æœˆæ”¶ â‰¥ ${p.minIncome.toLocaleString()} å…ƒ</span>
          ${p.maxLtv ? `<span class="dot"></span><span>åƒè€ƒæˆæ•¸ / å€æ•¸ï¼šç´„ ${p.maxLtv}</span>` : ""}
          <span class="dot"></span>
          <span class="score-chip ${scoreClass}">é©åˆåº¦ï¼š${p._score} / 100ï¼ˆ${scoreText}ï¼‰</span>
        </div>
      `;
      container.appendChild(el);
    });
  }

  // -----------------------
  // çµ„åˆç­–ç•¥å»ºè­°
  // -----------------------
  function renderStrategies(c, list) {
    const box = document.getElementById("strategyBox");
    if (!box) return;

    if (!list || !list.length) {
      box.innerHTML = "å°šæœªç”¢ç”Ÿçµ„åˆç­–ç•¥å»ºè­°ï¼Œè«‹å…ˆç”¢ç”Ÿ AI æ¨è–¦ã€‚";
      return;
    }

    const lines = [];
    const house = list.find((p) => p.category === "æˆ¿è²¸");
    const cash = list.find((p) => p.category === "ä¿¡è²¸");
    const car = list.find((p) => p.category === "æ±½è»Š");
    const moto = list.find((p) => p.category === "æ©Ÿè»Š");

    const ratio = c.debtRatio || 0;
    const ratioText = ratio ? `ç›®å‰è² å‚µæ¯”ç´„ ${ratio.toFixed(1)}%` : "ç›®å‰è² å‚µæ¯”æœªå¡«";

    if (c.asset === "house" && house) {
      let sA = `æ–¹æ¡ˆ Aï¼šä»¥ã€${house.company}ã€‘ã€Œ${house.name}ã€ä½œç‚ºä¸»åŠ›è³‡é‡‘ä¾†æºï¼Œ`;
      if (ratio > 50) {
        sA += "å„ªå…ˆæ•´åˆé«˜åˆ©è²¸æ¬¾ï¼Œé™ä½æ¯æœˆæœˆä»˜å£“åŠ›ã€‚";
      } else {
        sA += "å¯åšä¸€éƒ¨ä»½äºŒèƒæˆ–å¢è²¸ï¼Œæä¾›å‘¨è½‰èˆ‡æ•´åˆå½ˆæ€§ã€‚";
      }
      lines.push(sA);

      if (cash) {
        lines.push(
          `æ–¹æ¡ˆ Bï¼šæˆ¿è²¸ç”¨ä¾†è™•ç†è¼ƒå¤§é¡æ•´åˆï¼Œå‰©é¤˜å°é¡å‘¨è½‰å¯æ­é…ã€${cash.company}ã€‘ã€Œ${cash.name}ã€ï¼Œé¿å…å…¨æ•¸å£“åœ¨æˆ¿å±‹ä¸Šã€‚`
        );
      }
    }

    if (c.asset === "car" && car && cash) {
      lines.push(
        `æ–¹æ¡ˆ Cï¼šå…ˆä»¥ã€${car.company}ã€‘ã€Œ${car.name}ã€åšè»Šè²¸ / åŸèå–å¾—ä¸»è¦è³‡é‡‘ï¼Œå†ä»¥ã€${cash.company}ã€‘ã€Œ${cash.name}ã€è£œè¶³ä¸è¶³éƒ¨åˆ†ï¼Œåˆ†æ•£é‚„æ¬¾é¢¨éšªã€‚`
      );
    }

    if (c.asset === "bike" && moto) {
      lines.push(
        `æ–¹æ¡ˆ Dï¼šè‹¥åä¸‹åƒ…æœ‰æ©Ÿè»Šï¼Œå¯å„ªå…ˆä»¥ã€Œ${moto.name}ã€å–å¾—å°é¡å‘¨è½‰ï¼Œä¹‹å¾Œè¦–ä¿¡ç”¨æ¢å¾©æƒ…æ³ï¼Œå†è½‰å¾€éŠ€è¡Œä¿¡è²¸æˆ–æˆ¿è²¸ã€‚`
      );
    }

    if (!lines.length) {
      const top1 = list[0];
      const top2 = list[1];
      let base = `ç›®å‰ä¾æ¢ä»¶æœ€é©åˆçš„æ˜¯ã€${top1.company}ã€‘ã€Œ${top1.name}ã€ï¼Œ`;
      if (top2) {
        base += `å‚™é¸æ–¹æ¡ˆå¯è€ƒæ…®ã€${top2.company}ã€‘ã€Œ${top2.name}ã€ï¼Œ`;
      }
      base += "å¯¦éš›æ‰¿ä½œæ™‚å¯ä¾åˆ©ç‡ / æˆæ•¸ / æ‰‹çºŒè²»å†åšæ¯”è¼ƒã€‚";
      lines.push(base);
    }

    lines.push(`è£œå……èªªæ˜ï¼š${ratioText}ï¼Œå»ºè­°æ•´é«”æœˆä»˜æ§åˆ¶åœ¨æœˆæ”¶å…¥çš„ 50% ä»¥å…§è¼ƒç‚ºå®‰å…¨ã€‚`);

    box.innerHTML =
      "<ul class='memo-list'>" +
      lines.map((t) => `<li>${t}</li>`).join("") +
      "</ul>";
  }

  // -----------------------
  // Tab åˆ‡æ›
  // -----------------------
  function setActiveTab(key) {
    document.querySelectorAll(".pill-tab").forEach((btn) => {
      btn.classList.toggle("active", btn.dataset.tab === key);
    });
  }

  document.querySelectorAll(".pill-tab").forEach((btn) => {
    btn.addEventListener("click", () => {
      const tab = btn.dataset.tab;
      setActiveTab(tab);

      if (tab === "all") {
        const all = projects.map((p) => ({ ...p, _score: 50 }));
        renderProjects(all, "all");
        const box = document.getElementById("strategyBox");
        if (box) {
          box.innerHTML = "ç›®å‰ç‚ºå…¨éƒ¨å°ˆæ¡ˆåˆ—è¡¨æ¨¡å¼ï¼Œè«‹å…ˆç”¢ç”Ÿ AI æ¨è–¦ä»¥æŸ¥çœ‹çµ„åˆç­–ç•¥å»ºè­°ã€‚";
        }
      } else {
        const c = getCustomer();
        const scored = projects
          .map((p) => ({ ...p, _score: scoreProject(c, p) }))
          .filter((p) => p._score > 0)
          .sort((a, b) => b._score - a._score);

        if (tab === "alt") {
          renderProjects(scored.filter((p) => p._score >= 40).slice(0, 15), "alt");
        } else {
          renderProjects(scored.slice(0, 10), "best");
        }
        renderStrategies(c, scored);
      }
    });
  });

  // -----------------------
  // AI æ¨è–¦ / æ¸…ç©º
  // -----------------------
  document.getElementById("btnRecommend").addEventListener("click", () => {
    const c = getCustomer();
    const scored = projects
      .map((p) => ({ ...p, _score: scoreProject(c, p) }))
      .filter((p) => p._score > 0)
      .sort((a, b) => b._score - a._score);

    renderProjects(scored.slice(0, 10), "best");
    setActiveTab("best");
    renderStrategies(c, scored);
  });

  document.getElementById("btnClear").addEventListener("click", () => {
    document.getElementById("custName").value = "";
    document.getElementById("age").value = "";
    document.getElementById("income").value = "";
    document.getElementById("loanAmount").value = "";
    document.getElementById("debtMonthly").value = "";
    document.querySelector("input[name='asset'][value='none']").checked = true;
    document.getElementById("creditNormal").checked = true;
    document.getElementById("creditDelay").checked = false;
    document.getElementById("creditBad").checked = false;
    document.querySelectorAll(".companyFilter").forEach((c) => (c.checked = false));
    document.querySelectorAll(".wantType").forEach((c) => (c.checked = true));
    document.getElementById("summaryText").value = "";

    document.getElementById("projectList").innerHTML =
      '<div class="empty">å°šæœªç”¢ç”Ÿçµæœï¼Œè«‹å…ˆè¼¸å…¥æ¢ä»¶ä¸¦æŒ‰ä¸‹ã€ŒğŸ” ç”¢ç”Ÿ AI æ¨è–¦ã€ã€‚</div>';
    document.getElementById("strategyBox").innerHTML =
      "å°šæœªç”¢ç”Ÿçµ„åˆç­–ç•¥å»ºè­°ï¼Œè«‹å…ˆç”¢ç”Ÿ AI æ¨è–¦ã€‚";
  });

  // -----------------------
  // ç­‰é¡æœ¬æ¯è¨ˆç®—
  // -----------------------
  document.getElementById("btnEqCalc").addEventListener("click", () => {
    const P = Number(document.getElementById("eqLoan").value) || 0;
    const annual = Number(document.getElementById("eqRate").value) || 0;
    const n = Number(document.getElementById("eqMonths").value) || 0;

    if (!P || !annual || !n) {
      document.getElementById("eqResult").innerText = "è«‹å¡«å…¥å®Œæ•´çš„è²¸æ¬¾é‡‘é¡ / å¹´åˆ©ç‡ / æœŸæ•¸ã€‚";
      return;
    }

    const r = (annual / 100) / 12;
    const payment = (P * r) / (1 - Math.pow(1 + r, -n));
    const total = payment * n;
    const interest = total - P;

    document.getElementById("eqResult").innerHTML =
      `æ¯æœˆç´„éœ€ <strong>${payment.toFixed(0).toLocaleString()} å…ƒ</strong>ï¼Œ` +
      `ç¸½åˆ©æ¯ç´„ <strong>${interest.toFixed(0).toLocaleString()} å…ƒ</strong>ï¼ˆæœ¬æ¯åˆè¨ˆ ${total.toFixed(0).toLocaleString()} å…ƒï¼‰ã€‚`;
  });

  // -----------------------
  // æˆ¿è²¸æˆæ•¸ + äºŒèƒé¡åº¦
  // -----------------------
  document.getElementById("btnSecondCalc").addEventListener("click", () => {
    const price = Number(document.getElementById("housePrice").value) || 0;
    const first = Number(document.getElementById("firstMortgage").value) || 0;
    const maxLtv = Number(document.getElementById("maxLtv").value) || 0;

    if (!price || !maxLtv) {
      document.getElementById("secondResult").innerText = "è«‹è‡³å°‘å¡«å…¥ã€Œæˆ¿å±‹å¸‚åƒ¹ã€èˆ‡ã€Œæœ€é«˜ç¸½æˆæ•¸ã€ã€‚";
      return;
    }

    const maxTotal = price * (maxLtv / 100);
    const canSecond = Math.max(maxTotal - first, 0);

    document.getElementById("secondResult").innerHTML =
      `åœ¨ç¸½æˆæ•¸ <strong>${maxLtv}%</strong> ä¸‹ï¼Œå¯æ‰¿ä½œæˆ¿è²¸ç¸½é¡ç´„ ` +
      `<strong>${maxTotal.toFixed(0).toLocaleString()} å…ƒ</strong>ã€‚<br/>` +
      `ç›®å‰ç¬¬ä¸€èƒé¤˜é¡ ${first.toLocaleString()} å…ƒï¼Œç†è«–ä¸ŠäºŒèƒå°šå¯æ“ä½œç´„ ` +
      `<strong>${canSecond.toFixed(0).toLocaleString()} å…ƒ</strong>ï¼ˆå¯¦éš›é‡‘é¡ä»éœ€çœ‹ç‰©ä»¶åŠå…¬å¸è©•ä¼°ï¼‰ã€‚`;
  });

  // -----------------------
  // å¹¾åˆ†è©¦ç®—ï¼šç¸½é‡‘é¡ Ã· æœŸæ•¸ +ï¼ˆç¸½é‡‘é¡ Ã— å¹¾åˆ†ï¼‰
  // -----------------------
  document.getElementById("btnFenCalc").addEventListener("click", () => {
    const amount = Number(document.getElementById("fenAmount").value) || 0;
    const fen = Number(document.getElementById("fenRate").value) || 0;
    const months = Number(document.getElementById("fenMonths").value) || 0;

    if (!amount || !fen || !months) {
      document.getElementById("fenResult").innerText = "è«‹å¡«å…¥å€Ÿæ¬¾é‡‘é¡ / å¹¾åˆ† / æœŸæ•¸ã€‚";
      return;
    }

    const principalPart = amount / months;
    const interestPart = amount * (fen / 100);
    const monthly = principalPart + interestPart;
    const totalPay = monthly * months;
    const totalInterest = totalPay - amount;

    const annualRate = fen * 12;
    let warn = "";
    if (annualRate > 16) {
      warn =
        "<br/>âš  ä¾æ°‘æ³•ç´„å®šåˆ©ç‡ä¸Šé™ 16% å¹´åˆ©ç‡ï¼Œæœ¬è©¦ç®—å·²è¶…éæ­¤å€é–“ï¼Œå¯¦å‹™ä¸Šå¸¸ä»¥é•ç´„é‡‘æˆ–å…¶ä»–åç›®å‘ˆç¾ï¼Œè«‹ç‰¹åˆ¥ç•™æ„åˆç´„ã€‚";
    }

    document.getElementById("fenResult").innerHTML =
      `æ¯æœˆæœ¬é‡‘ç´„ <strong>${principalPart.toFixed(0).toLocaleString()} å…ƒ</strong>ï¼Œ` +
      `åˆ©æ¯ï¼ˆ${fen} åˆ†ï¼‰ç´„ <strong>${interestPart.toFixed(0).toLocaleString()} å…ƒ</strong>ï¼Œ` +
      `æ¯æœˆæ‡‰ç¹³ <strong>${monthly.toFixed(0).toLocaleString()} å…ƒ</strong>ã€‚<br/>` +
      `ç¸½ç¹³é‡‘é¡ç´„ ${totalPay.toFixed(0).toLocaleString()} å…ƒï¼Œå…¶ä¸­åˆ©æ¯ç´„ ` +
      `<strong>${totalInterest.toFixed(0).toLocaleString()} å…ƒ</strong>ã€‚` +
      `<br/>æ›ç®—å¹´åˆ©ç‡ç´„ <strong>${annualRate.toFixed(1)}%</strong>ã€‚` +
      warn;
  });

  // -----------------------
  // ç´”åˆ©æ¯è©¦ç®—ï¼ˆåªç¹³åˆ©æ¯ï¼‰
  // -----------------------
  document.getElementById("btnIoCalc").addEventListener("click", () => {
    const amount = Number(document.getElementById("ioAmount").value) || 0;
    const rateFen = Number(document.getElementById("ioRate").value) || 0;
    const months = Number(document.getElementById("ioMonths").value) || 0;

    if (!amount || !rateFen || !months) {
      document.getElementById("ioResult").innerText = "è«‹å¡«å…¥å€Ÿæ¬¾é‡‘é¡ / å¹¾åˆ†æˆ–æœˆåˆ©ç‡ / æœŸæ•¸ã€‚";
      return;
    }

    const monthRate = rateFen / 100; // å¹¾åˆ† â†’ æœˆåˆ©ç‡
    const monthlyInterest = amount * monthRate;
    const totalInterest = monthlyInterest * months;
    const annualRate = monthRate * 12 * 100;

    document.getElementById("ioResult").innerHTML =
      `æ¯æœˆåªéœ€ç¹³åˆ©æ¯ç´„ <strong>${monthlyInterest.toFixed(0).toLocaleString()} å…ƒ</strong>ï¼Œ` +
      `ç¹³æ»¿ ${months} æœŸï¼Œç¸½åˆ©æ¯ç´„ <strong>${totalInterest.toFixed(0).toLocaleString()} å…ƒ</strong>ã€‚` +
      `<br/>æ›ç®—å¹´åˆ©ç‡ç´„ <strong>${annualRate.toFixed(1)}%</strong>ï¼Œæœ¬é‡‘ ${amount.toLocaleString()} å…ƒä¸æœƒé™ä½ï¼ŒæœŸæ»¿ä»éœ€ä¸€æ¬¡è™•ç†ã€‚`;
  });

  // -----------------------
  // åˆ°æ‰‹é‡‘é¡è©¦ç®—
  // -----------------------
  document.getElementById("btnNetCalc").addEventListener("click", () => {
    const approve = Number(document.getElementById("netApprove").value) || 0;
    const payoff = Number(document.getElementById("netPayoff").value) || 0;
    const service = Number(document.getElementById("netService").value) || 0;
    const other = Number(document.getElementById("netOther").value) || 0;

    if (!approve) {
      document.getElementById("netResult").innerText = "è«‹è‡³å°‘å¡«å…¥æ ¸å‡†é‡‘é¡ã€‚";
      return;
    }

    const net = approve - payoff - service - other;

    document.getElementById("netResult").innerHTML =
      `æ ¸å‡†é‡‘é¡ï¼š${approve.toLocaleString()} å…ƒ<br/>` +
      `æ‰£é™¤ä»£å„Ÿï¼š${payoff.toLocaleString()} å…ƒ<br/>` +
      `æ‰£é™¤æœå‹™è²» / ä»£æ›¸è²»ï¼š${service.toLocaleString()} å…ƒ<br/>` +
      `æ‰£é™¤å…¶ä»–é›œè²»ï¼š${other.toLocaleString()} å…ƒ<br/>` +
      `â¡ å®¢æˆ¶å¯¦éš›åˆ°æ‰‹ç´„ <strong>${net.toFixed(0).toLocaleString()} å…ƒ</strong>ã€‚`;
  });

  // -----------------------
  // ä¿¡ç”¨åˆ†æ•¸é ä¼°
  // -----------------------
  document.getElementById("btnScore").addEventListener("click", () => {
    const year = Number(document.getElementById("scYear").value) || 0;
    const delay = Number(document.getElementById("scDelay").value) || 0;
    const debtRatio = Number(document.getElementById("scDebtRatio").value) || 0;
    const asset = Number(document.getElementById("scAsset").value) || 0;

    let score = 60;

    if (year >= 5) score += 10;
    else if (year >= 2) score += 5;
    else if (year < 1) score -= 5;

    if (delay === 0) score += 10;
    else if (delay === 1) score -= 10;
    else score -= 25;

    if (debtRatio < 30) score += 10;
    else if (debtRatio > 50) score -= 15;

    score += asset;

    if (score > 100) score = 100;
    if (score < 0) score = 0;

    let level = "æ™®é€šå¯è«‡";
    let color = "#1d4ed8";
    if (score >= 85) {
      level = "é«”è³ªä½³ï¼ŒéŠ€è¡Œä»¶ä¸»åŠ›";
      color = "#15803d";
    } else if (score >= 70) {
      level = "å¤šæ•¸éŠ€è¡Œå¯è«‡";
      color = "#2563eb";
    } else if (score >= 55) {
      level = "éœ€æ­é…æ“”ä¿æˆ–æ°‘é–“ä»¶";
      color = "#92400e";
    } else {
      level = "åå‘æ°‘é–“ä»¶ / ä»£æ›¸ä»¶";
      color = "#b91c1c";
    }

    document.getElementById("scoreResult").innerHTML =
      `é ä¼°ä¿¡ç”¨åˆ†æ•¸ï¼šç´„ <strong style="color:${color}">${score} åˆ†</strong>ï¼ˆ${level}ï¼‰ã€‚<br/>` +
      `â€» åƒ…ä¾›ä½ è©•ä¼°å®¢æˆ¶é«”è³ªåƒè€ƒï¼Œå¯¦éš›ä»ä»¥å„éŠ€è¡Œæˆä¿¡æº–å‰‡ç‚ºä¸»ã€‚`;
  });

  // -----------------------
  // æ–‡å­—æ‘˜è¦ / è©±è¡“
  // -----------------------
  function buildSummaryText() {
    const c = getCustomer();
    const nameRaw = (document.getElementById("custName").value || "").trim();
    const name = nameRaw || "æ‚¨";

    const incomeWan = c.income ? (c.income / 10000).toFixed(1) : null;
    const debtRatio = c.debtRatio || 0;
    const ratioText = c.debtMonthly
      ? `ç›®å‰æ¯æœˆå›ºå®šé‚„æ¬¾ç´„ ${c.debtMonthly.toLocaleString()} å…ƒï¼Œè² å‚µæ¯”ç´„ ${debtRatio.toFixed(1)}%ã€‚`
      : "ç›®å‰æœªå¡«å¯«æ—¢æœ‰è² å‚µï¼Œå¯¦éš›è² å‚µæ¯”éœ€å†ç¢ºèªã€‚";

    let assetText = "ç›®å‰åä¸‹ç„¡æˆ¿ç„¡è»Šï¼Œä»¥ä¿¡è²¸ã€å°é¡ã€æ‰‹æ©Ÿï¼æ©Ÿè»Šç­‰æ–¹æ¡ˆç‚ºä¸»ã€‚";
    if (c.asset === "house") {
      assetText = "åä¸‹å·²æœ‰æˆ¿å±‹ï¼Œå¯å„ªå…ˆè©•ä¼°æˆ¿å±‹å¢è²¸æˆ–äºŒèƒæ•´åˆé«˜åˆ©è²¸æ¬¾ã€‚";
    } else if (c.asset === "car") {
      assetText = "åä¸‹æœ‰æ±½è»Šï¼Œå¯æ­é…è»Šè²¸ / åŸèåšä¸€éƒ¨åˆ†è³‡é‡‘é‹ç”¨ã€‚";
    } else if (c.asset === "bike") {
      assetText = "åä¸‹æœ‰æ©Ÿè»Šï¼Œå¯è©•ä¼°æ©Ÿè»Šè²¸æ¬¾æˆ–åŸèä½œç‚ºå°é¡å‘¨è½‰ç®¡é“ã€‚";
    }

    let creditText = "æ•´é«”ä¿¡ç”¨æ­£å¸¸ï¼Œæ²’æœ‰æ˜é¡¯ç‘•ç–µã€‚";
    if (c.creditLevel === "light") {
      creditText = "éå»æœ‰ä¸€äº›è¼•å¾®é²ç¹³æˆ–å°ç‘•ç–µï¼Œä»æœ‰æ©Ÿæœƒè©•ä¼°éŠ€è¡Œæˆ–èè³‡å°ˆæ¡ˆã€‚";
    } else if (c.creditLevel === "heavy") {
      creditText = "ç›®å‰ä¿¡ç”¨ç‹€æ³åé‡åº¦ç‘•ç–µï¼ŒéŠ€è¡Œä»¶é›£åº¦è¼ƒé«˜ï¼Œè¼ƒé©åˆæ°‘é–“ï¼äºŒèƒï¼ä»£æ›¸è·¯ç·šã€‚";
    }

    let dirText = "";
    if (c.asset === "house") {
      dirText += "ä»¥æˆ¿å±‹å¢è²¸æˆ–äºŒèƒä½œç‚ºä¸»åŠ›è³‡é‡‘ä¾†æºï¼Œæ­é…æ•´åˆé«˜åˆ©è² å‚µï¼Œæ˜¯ç›®å‰è¼ƒå„ªå…ˆçš„æ–¹å‘ã€‚";
    } else if (c.asset === "car") {
      dirText += "å¯å…ˆä»¥è»Šè²¸æˆ–è»Šè¼›åŸèå–å¾—ä¸»åŠ›è³‡é‡‘ï¼Œå¿…è¦æ™‚å†æ­é…å°‘é‡ä¿¡è²¸è£œè¶³ã€‚";
    } else if (c.asset === "bike") {
      dirText += "ä»¥æ©Ÿè»Šè²¸æ¬¾æˆ–å°é¡ä¿¡è²¸ç‚ºä¸»ï¼Œæœªä¾†ä¿¡ç”¨é«”è³ªæ”¹å–„å¾Œå†è©•ä¼°æˆ¿è²¸æˆ–è¼ƒå¤§å‹è³‡é‡‘æ–¹æ¡ˆã€‚";
    } else {
      dirText += "ç›®å‰ä»¥ä¿¡è²¸ã€å°é¡åˆ†æœŸæˆ–æ‰‹æ©Ÿï¼æ©Ÿè»Šå°ˆæ¡ˆç‚ºä¸»ï¼Œç­‰ä¿¡ç”¨èˆ‡æ”¶å…¥æ¢ä»¶æ›´ç©©å®šå¾Œå†é€²éšåˆ°æˆ¿è²¸ / å¤§é¡è³‡é‡‘è¦åŠƒã€‚";
    }

    let safeLine = "";
    if (c.income > 0) {
      const safeMonth = c.income * 0.5 - c.debtMonthly;
      if (safeMonth > 0) {
        safeLine =
          `ä»¥æœˆæ”¶å…¥ç´„ ${c.income.toLocaleString()} å…ƒä¾†çœ‹ï¼Œå»ºè­°å…¨éƒ¨è²¸æ¬¾æœˆä»˜æ§åˆ¶åœ¨æ”¶å…¥çš„ 50% ä»¥å…§ï¼Œ` +
          `æ–°æ¡ˆä»¶æœˆä»˜ç›¡é‡ä¸è¦è¶…éç´„ ${safeMonth.toFixed(0).toLocaleString()} å…ƒï¼Œæ¯”è¼ƒå®‰å…¨ã€‚`;
      } else {
        safeLine =
          "ç›®å‰è² å‚µæ¯”å·²æ¥è¿‘æˆ–è¶…éæ”¶å…¥çš„ 50%ï¼Œå»ºè­°ä»¥æ•´åˆé«˜åˆ©è² å‚µã€é™ä½æœˆä»˜ç‚ºå„ªå…ˆï¼Œè€Œä¸æ˜¯å†å¢åŠ æ–°çš„æœˆä»˜å£“åŠ›ã€‚";
      }
    } else {
      safeLine = "è‹¥è¦æ›´ç²¾æº–è¦åŠƒæœˆä»˜èˆ‡é¡åº¦ï¼Œå»ºè­°å…ˆç¢ºèªå¯¦éš›æœˆæ”¶å…¥èˆ‡ç¾æœ‰è²¸æ¬¾æœˆä»˜ã€‚";
    }

    const ageText = c.age ? `${c.age} æ­²` : "å¹´é½¡æœªå¡«";
    const incomeText = incomeWan ? `æœˆæ”¶ç´„ ${incomeWan} è¬å…ƒ` : "æœˆæ”¶å…¥æœªå¡«";

    const summary =
      `${name}ç›®å‰ç´„ ${ageText}ï¼Œ${incomeText}ï¼Œ${assetText}\n` +
      `${ratioText}\n` +
      `ä¿¡ç”¨ç‹€æ³è€Œè¨€ï¼Œ${creditText}\n\n` +
      `ä»¥ç›®å‰æ¢ä»¶ä¾†çœ‹ï¼Œå»ºè­°çš„æ“ä½œæ–¹å‘å¦‚ä¸‹ï¼š\n` +
      `1ï¸âƒ£ è³‡é‡‘è¦åŠƒæ–¹å‘ï¼š${dirText}\n` +
      `2ï¸âƒ£ æœˆä»˜å®‰å…¨å»ºè­°ï¼š${safeLine}\n\n` +
      `ä»¥ä¸Šæ˜¯åˆæ­¥è©¦ç®—èˆ‡å»ºè­°ï¼Œå¯¦éš›æ ¸å‡†é¡åº¦èˆ‡åˆ©ç‡ä»éœ€ä¾å„éŠ€è¡Œ / é‡‘èå…¬å¸å¯©æ ¸ç‚ºæº–ã€‚`;

    return summary;
  }

  document.getElementById("btnSummary").addEventListener("click", () => {
    document.getElementById("summaryText").value = buildSummaryText();
  });

  document.getElementById("btnCopySummary").addEventListener("click", () => {
    const text = document.getElementById("summaryText").value;
    if (!text.trim()) {
      alert("è«‹å…ˆç”¢ç”Ÿæ‘˜è¦ï¼Œå†é€²è¡Œè¤‡è£½ã€‚");
      return;
    }
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(
        () => alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œå¯ä»¥è²¼åˆ° Line æˆ–å‚™è¨»ã€‚"),
        () => alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½ã€‚")
      );
    } else {
      alert("ç€è¦½å™¨ä¸æ”¯æ´è‡ªå‹•è¤‡è£½ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—ã€‚");
    }
  });

  // -----------------------
  // æ¡ˆä»¶æš«å­˜ï¼ˆlocalStorageï¼‰
  // -----------------------
  const CASE_KEY = "loan_cases_v1";

  function getFormSnapshot() {
    const c = getCustomer();
    return {
      custName: document.getElementById("custName").value || "",
      age: document.getElementById("age").value || "",
      income: document.getElementById("income").value || "",
      loanAmount: document.getElementById("loanAmount").value || "",
      debtMonthly: document.getElementById("debtMonthly").value || "",
      asset: c.asset,
      creditNormal: c.creditNormal,
      creditDelay: c.creditDelay,
      creditBad: c.creditBad,
      companyFilters: c.companyFilters,
      wantTypes: c.wantTypes
    };
  }

  function setFormSnapshot(snap) {
    document.getElementById("custName").value = snap.custName || "";
    document.getElementById("age").value = snap.age || "";
    document.getElementById("income").value = snap.income || "";
    document.getElementById("loanAmount").value = snap.loanAmount || "";
    document.getElementById("debtMonthly").value = snap.debtMonthly || "";

    if (snap.asset) {
      const radio = document.querySelector(`input[name='asset'][value='${snap.asset}']`);
      if (radio) radio.checked = true;
    }

    document.getElementById("creditNormal").checked = !!snap.creditNormal;
    document.getElementById("creditDelay").checked = !!snap.creditDelay;
    document.getElementById("creditBad").checked = !!snap.creditBad;

    document.querySelectorAll(".companyFilter").forEach((c) => {
      c.checked = snap.companyFilters?.includes(c.value) || false;
    });
    document.querySelectorAll(".wantType").forEach((c) => {
      c.checked = snap.wantTypes?.includes(c.value) || false;
    });
  }

  function loadCasesFromStorage() {
    try {
      const raw = localStorage.getItem(CASE_KEY);
      if (!raw) return [];
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return [];
      return arr;
    } catch {
      return [];
    }
  }

  function saveCasesToStorage(arr) {
    localStorage.setItem(CASE_KEY, JSON.stringify(arr));
  }

  function refreshCaseList() {
    const listEl = document.getElementById("caseList");
    const cases = loadCasesFromStorage();
    if (!cases.length) {
      listEl.className = "empty";
      listEl.innerText = "ç›®å‰æ²’æœ‰æš«å­˜æ¡ˆä»¶ã€‚";
      return;
    }
    listEl.className = "";
    listEl.innerHTML = "";
    cases
      .slice()
      .sort((a, b) => b.id - a.id)
      .forEach((c) => {
        const btn = document.createElement("button");
        btn.className = "btn-outline case-item-btn";
        btn.setAttribute("data-id", c.id);
        const timeText = new Date(c.time).toLocaleString("zh-TW");
        btn.innerHTML = `
          <span>${c.label}</span>
          <span class="case-item-meta">${timeText}</span>
        `;
        listEl.appendChild(btn);
      });
  }

  document.getElementById("btnSaveCase").addEventListener("click", () => {
    const labelInput = document.getElementById("caseLabel");
    let label = (labelInput.value || "").trim();
    const snap = getFormSnapshot();
    if (!label) {
      label = snap.custName ? `${snap.custName}ï¼ˆæœªå‘½åï¼‰` : "æœªå‘½åæ¡ˆä»¶";
    }
    const cases = loadCasesFromStorage();
    cases.push({
      id: Date.now(),
      label,
      time: new Date().toISOString(),
      form: snap
    });
    saveCasesToStorage(cases);
    labelInput.value = "";
    refreshCaseList();
    alert("å·²åŠ å…¥æš«å­˜æ¸…å–®ã€‚");
  });

  document.getElementById("btnClearCases").addEventListener("click", () => {
    if (!confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æš«å­˜æ¡ˆä»¶å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•æ¢å¾©ã€‚")) return;
    saveCasesToStorage([]);
    refreshCaseList();
  });

  document.getElementById("caseList").addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-id]");
    if (!btn) return;
    const id = Number(btn.getAttribute("data-id"));
    const cases = loadCasesFromStorage();
    const found = cases.find((c) => c.id === id);
    if (!found) return;
    setFormSnapshot(found.form);
    alert(`å·²è¼‰å…¥æš«å­˜æ¡ˆä»¶ï¼šã€Œ${found.label}ã€ã€‚`);
  });

  // åˆå§‹åŒ–æš«å­˜åˆ—è¡¨
  refreshCaseList();
</script>
</body>
</html>
