<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è²¸æ¬¾æ™ºèƒ½åˆ†æç³»çµ± v7</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #2563eb;
      --primary-soft: #dbeafe;
      --danger: #dc2626;
      --bg: #f4f5fb;
      --card: #ffffff;
      --border: #e5e7eb;
      --text: #111827;
      --muted: #6b7280;
      --success: #16a34a;
      --warning: #f97316;
      --radius-lg: 16px;
      --radius-md: 10px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Microsoft JhengHei", system-ui, sans-serif;
      background: radial-gradient(circle at top, #e0edff 0, #f4f5fb 40%, #f4f5fb 100%);
      color: var(--text);
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    header h1 {
      margin: 0;
      font-size: 22px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header h1 span.logo {
      width: 32px;
      height: 32px;
      border-radius: 12px;
      background: linear-gradient(135deg, #6366f1, #ec4899);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 18px;
    }

    header .subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    .pill {
      background: #eef2ff;
      color: #4f46e5;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 3fr);
      gap: 16px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      box-shadow: 0 18px 30px rgba(15, 23, 42, 0.08);
      padding: 14px 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card h2 span.icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--primary-soft);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: var(--primary);
    }

    .card-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .card-sub {
      font-size: 11px;
      color: var(--muted);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    @media (max-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    label {
      font-size: 12px;
      color: var(--muted);
      display: block;
      margin-bottom: 2px;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 13px;
      outline: none;
      background: #f9fafb;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
      background: #fff;
    }

    .checkbox-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px 16px;
      margin-top: 4px;
    }

    .checkbox-row label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      margin-bottom: 0;
    }

    .checkbox-row input {
      width: 14px;
      height: 14px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .btn-primary:active {
      transform: translateY(1px);
    }

    .btn-outline {
      background: #fff;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
      background: #f3f4f6;
      color: #4b5563;
      margin-right: 4px;
      margin-bottom: 2px;
    }

    .tag-primary {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .tag-green {
      background: #dcfce7;
      color: #15803d;
    }

    .tag-orange {
      background: #ffedd5;
      color: #ea580c;
    }

    .tag-red {
      background: #fee2e2;
      color: #b91c1c;
    }

    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .tab {
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid transparent;
      background: transparent;
      cursor: pointer;
      color: var(--muted);
    }

    .tab.active {
      background: #eff6ff;
      color: #1d4ed8;
      border-color: #bfdbfe;
      font-weight: 500;
    }

    .projects-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .project-card {
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 10px 10px 8px;
      background: #ffffff;
      position: relative;
    }

    .project-header {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      align-items: flex-start;
      margin-bottom: 4px;
    }

    .project-title {
      font-size: 13px;
      font-weight: 600;
    }

    .badge-level {
      font-size: 11px;
      border-radius: 999px;
      padding: 2px 7px;
      background: #e5f4ff;
      color: #0369a1;
      white-space: nowrap;
    }

    .badge-level.level-top {
      background: #dcfce7;
      color: #166534;
    }

    .project-meta {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .project-meta span {
      margin-right: 8px;
    }

    .reason {
      font-size: 11px;
      color: #4b5563;
      background: #f9fafb;
      border-radius: 8px;
      padding: 4px 6px;
      margin-top: 4px;
    }

    .section-title {
      font-size: 12px;
      font-weight: 600;
      margin: 6px 0 2px;
    }

    .calc-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    @media (max-width: 800px) {
      .calc-grid {
        grid-template-columns: 1fr;
      }
    }

    .calc-result {
      font-size: 12px;
      margin-top: 4px;
      color: var(--success);
    }

    .footer-note {
      margin-top: 10px;
      font-size: 10px;
      color: var(--muted);
      text-align: right;
    }

    .chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .chip {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      font-size: 11px;
      cursor: pointer;
    }

    .chip.active {
      background: #2563eb;
      color: #fff;
      border-color: #1d4ed8;
    }

    .empty {
      font-size: 12px;
      color: var(--muted);
      background: #f9fafb;
      border-radius: 10px;
      padding: 8px;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>
        <span class="logo">L</span>
        è²¸æ¬¾æ™ºèƒ½åˆ†æç³»çµ± <span style="font-size:12px;color:#6b7280;">v7</span>
      </h1>
      <div class="subtitle">
        ä¸€æ¬¡è¼¸å…¥å®¢æˆ¶æ¢ä»¶ âœ è‡ªå‹•é…å°æˆ¿è²¸ / ä¿¡è²¸ / æ‰‹æ©Ÿ / è»Šè²¸ / äºŒä¸‰èƒå°ˆæ¡ˆï¼Œä¸¦æä¾›æœˆä»˜è©¦ç®—
      </div>
    </div>
    <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
      <div class="pill">âœ… ç„¡éœ€å®‰è£ Appï¼Œæ‰‹æ©Ÿç›´æ¥æ‰“é–‹ç¶²å€å³å¯ä½¿ç”¨</div>
      <div style="font-size:10px;color:#9ca3af;">è³‡æ–™åƒ…å„²å­˜åœ¨ä½ æœ¬æ©Ÿç€è¦½å™¨ï¼Œä¸ä¸Šå‚³ä¼ºæœå™¨ã€‚</div>
    </div>
  </header>

  <div class="layout">
    <!-- å·¦å´ï¼šå®¢æˆ¶æ¢ä»¶ + è¨ˆç®—æ©Ÿ -->
    <section class="card">
      <div class="card-header-row">
        <h2><span class="icon">ğŸ‘¤</span> å®¢æˆ¶æ¢ä»¶ï¼ˆAI æ™ºèƒ½æ¨è–¦ï¼‰</h2>
      </div>
      <div class="card-sub">
        å¡«è¶Šå®Œæ•´ï¼Œæ¨è–¦è¶Šæº–ç¢ºã€‚æœªå¡«æ¬„ä½è¦–ç‚ºã€Œä¸é™ã€ã€‚
      </div>

      <div class="form-grid" style="margin-top:6px;">
        <div>
          <label>å¹´é½¡</label>
          <input type="number" id="age" placeholder="ä¾‹ï¼š30" min="18" max="80" />
        </div>
        <div>
          <label>æœˆæ”¶å…¥ï¼ˆå¯¦é ˜ï¼‰</label>
          <input type="number" id="income" placeholder="ä¾‹ï¼š42000" min="0" />
        </div>
        <div>
          <label>è¯å¾µåˆ†æ•¸ / å…§è©•ï¼ˆå¤§ç´„ï¼‰</label>
          <input type="number" id="score" placeholder="ä¾‹ï¼š600" min="300" max="900" />
        </div>
        <div>
          <label>åœ¨è·å¹´è³‡ï¼ˆå¹´ï¼‰</label>
          <input type="number" id="years" placeholder="ä¾‹ï¼š2" min="0" step="0.5" />
        </div>
      </div>

      <div style="margin-top:6px;">
        <label>ç›®å‰æŒæœ‰è³‡ç”¢ / èº«ä»½ï¼ˆå¯è¤‡é¸ï¼‰</label>
        <div class="checkbox-row">
          <label><input type="checkbox" id="hasPayroll" /> æœ‰è–ªè½‰</label>
          <label><input type="checkbox" id="hasLabor" /> æœ‰å‹ä¿ / å¥ä¿</label>
          <label><input type="checkbox" id="hasHouse" /> åä¸‹æœ‰æˆ¿</label>
          <label><input type="checkbox" id="hasCar" /> åä¸‹æœ‰æ±½è»Š</label>
          <label><input type="checkbox" id="hasBike" /> åä¸‹æœ‰æ©Ÿè»Š</label>
          <label><input type="checkbox" id="isUnion" /> å·¥æœƒæŠ•ä¿</label>
        </div>
      </div>

      <div style="margin-top:6px;">
        <label>å®¢æˆ¶ä¿¡ç”¨ç‹€æ³å¤§è‡´è©•ä¼°</label>
        <select id="creditStatus">
          <option value="">æœªæŒ‡å®š</option>
          <option value="top">å„ªè³ªï¼ˆç„¡é²ç¹³ã€ç„¡å‚µå‹™å”å•†ï¼‰</option>
          <option value="normal">ä¸€èˆ¬æ­£å¸¸</option>
          <option value="weak">ç¨å¼±ï¼ˆå¶æœ‰é²ç¹³ï¼‰</option>
          <option value="bad">ç‘•ç–µï¼ˆå”å•†ã€å¼·åœã€å‘†å¸³ç­‰ï¼‰</option>
        </select>
      </div>

      <div style="margin-top:6px;">
        <label>å¸Œæœ›æ–¹æ¡ˆé¡åˆ¥ï¼ˆå¯è¤‡é¸ï¼‰</label>
        <div class="chip-group" id="typeChips">
          <!-- JS ç”¢ç”Ÿ -->
        </div>
      </div>

      <div style="margin-top:6px;">
        <label>åªçœ‹å“ªäº›å…¬å¸ï¼ˆå¯å¤šé¸ï¼Œä¸é¸=å…¨éƒ¨ï¼‰</label>
        <div class="chip-group" id="companyChips">
          <!-- JS ç”¢ç”Ÿ -->
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="btnRecommend">âš¡ ç”¢ç”Ÿ AI æ¨è–¦</button>
        <button class="btn-outline" id="btnReset">æ¸…ç©ºæ¢ä»¶</button>
      </div>

      <!-- è¨ˆç®—æ©Ÿ v7 -->
      <div style="margin-top:14px;border-top:1px dashed #e5e7eb;padding-top:10px;">
        <div class="card-header-row">
          <h2><span class="icon">ğŸ§®</span> å¿«é€Ÿè©¦ç®—ï¼ˆæœˆä»˜ / æˆæ•¸ï¼‰</h2>
        </div>
        <div class="calc-grid">
          <div>
            <div class="section-title">ç­‰é¡æœ¬æ¯æœˆä»˜è©¦ç®—ï¼ˆä¿¡è²¸ / è»Šè²¸ / æ‰‹æ©Ÿï¼‰</div>
            <div class="form-grid" style="grid-template-columns:1fr 1fr;gap:6px;">
              <div>
                <label>è²¸æ¬¾é‡‘é¡</label>
                <input type="number" id="calcAmount" placeholder="100000" />
              </div>
              <div>
                <label>æœŸæ•¸ï¼ˆæœˆï¼‰</label>
                <input type="number" id="calcMonths" placeholder="36" />
              </div>
              <div>
                <label>å¹´åˆ©ç‡ï¼ˆ%ï¼‰</label>
                <input type="number" id="calcRate" placeholder="10" step="0.1" />
              </div>
            </div>
            <div class="btn-row" style="margin-top:6px;">
              <button class="btn-outline" id="btnCalcPay">è¨ˆç®—æœˆä»˜</button>
            </div>
            <div class="calc-result" id="calcPayResult"></div>
          </div>

          <div>
            <div class="section-title">æˆ¿è²¸æˆæ•¸/äºŒèƒè©¦ç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰</div>
            <div class="form-grid" style="grid-template-columns:1fr 1fr;gap:6px;">
              <div>
                <label>æˆ¿å±‹ä¼°åƒ¹</label>
                <input type="number" id="houseValue" placeholder="6000000" />
              </div>
              <div>
                <label>ç¾æœ‰ä¸€èƒé¤˜é¡</label>
                <input type="number" id="firstLoan" placeholder="3000000" />
              </div>
              <div>
                <label>æœ€é«˜æˆæ•¸ï¼ˆ%ï¼‰</label>
                <input type="number" id="maxLtv" placeholder="80" step="1" />
              </div>
            </div>
            <div class="btn-row" style="margin-top:6px;">
              <button class="btn-outline" id="btnCalcSecond">è¨ˆç®—å¯åšäºŒèƒé¡åº¦</button>
            </div>
            <div class="calc-result" id="calcSecondResult"></div>
          </div>
        </div>
      </div>

      <div class="footer-note">
        â€» æœ¬ç³»çµ±åƒ…å”åŠ©ä½ å¿«é€Ÿç¯©é¸å°ˆæ¡ˆèˆ‡è©¦ç®—é‡‘é¡ï¼Œå¯¦éš›æ ¸å‡†èˆ‡æ¢ä»¶ä»¥å„éŠ€è¡Œ / é‡‘èå…¬å¸ç‚ºæº–ã€‚
      </div>
    </section>

    <!-- å³å´ï¼šæ¨è–¦çµæœ + å°ˆæ¡ˆåˆ—è¡¨ -->
    <section class="card">
      <div class="card-header-row">
        <h2><span class="icon">ğŸ“‹</span> AI æ¨è–¦çµæœèˆ‡æ‰€æœ‰å°ˆæ¡ˆ</h2>
        <div class="card-sub" id="summaryText">è«‹å…ˆè¼¸å…¥å·¦å´æ¢ä»¶ä¸¦æŒ‰ã€Œç”¢ç”Ÿ AI æ¨è–¦ã€</div>
      </div>

      <div class="tabs" id="resultTabs">
        <button class="tab active" data-tab="best">â­ æœ€é©åˆæ¨è–¦</button>
        <button class="tab" data-tab="backup">âœ… å¯å‚™é¸æ–¹æ¡ˆ</button>
        <button class="tab" data-tab="all">ğŸ“š å…¨éƒ¨å°ˆæ¡ˆåˆ—è¡¨</button>
      </div>

      <div id="tabContent">
        <!-- JS å¡«å…¥ -->
      </div>
    </section>
  </div>
</div>

<script>
/* =========================
   1. å°ˆæ¡ˆè³‡æ–™ï¼ˆä½ å¯ä»¥è‡ªè¡Œå¢åŠ /ä¿®æ”¹ï¼‰
   ========================= */

const projects = [
  /* æˆ¿è²¸ / äºŒèƒ */
  {
    id: "hx_house_2nd",
    name: "é¼ä¿¡ åé‚Šè²¸ï¼ˆäºŒèƒæˆ¿è²¸ï¼‰",
    company: "é¼ä¿¡",
    type: "äºŒèƒ",
    level: "ä¸€èˆ¬",
    preferLevel: "normal",
    minAge: 18,
    maxAge: 80,
    needHouse: true,
    needBike: false,
    needCar: false,
    needPayroll: false,
    needLabor: false,
    minScore: 0,
    minIncome: 0,
    tags: ["æˆ¿è²¸", "äºŒèƒ", "ä»£å„Ÿæ•´åˆ"],
    rate: "ç´„ 10%~24%",
    terms: "æœ€é•· 240 æœŸ",
    note: "éœ€åä¸‹æœ‰æˆ¿ï¼Œå¯åšæ•´åˆã€å¢è²¸ï¼Œéƒ¨åˆ†æ¡ˆä»¶å¯å…ˆæ’¥å¾Œè£œä»¶ã€‚",
  },
  {
    id: "xx_house_prime",
    name: "æ–°é‘« æˆ¿è²¸ å„ªè³ªä¸€èˆ¬å°ˆæ¡ˆ",
    company: "æ–°é‘«",
    type: "æˆ¿è²¸",
    level: "å„ªè³ª",
    preferLevel: "top",
    minAge: 20,
    maxAge: 70,
    needHouse: true,
    needPayroll: false,
    needLabor: false,
    minScore: 620,
    minIncome: 30000,
    tags: ["æˆ¿è²¸", "ä¸€èƒ", "éŠ€è¡Œä»¶"],
    rate: "ä¾éŠ€è¡Œå…¬å‘Š",
    terms: "æœ€é•· 300 æœŸ",
    note: "å®¢æˆ¶æ¢ä»¶ä½³æ™‚ï¼Œå¯å„ªå…ˆè€ƒæ…®éŠ€è¡Œæˆ¿è²¸ï¼Œæ–°é‘«å”åŠ©éŠœæ¥èˆ‡ä½œæ¥­ã€‚",
  },

  /* ä¿¡è²¸ / æ©Ÿè»Š / æ±½è»Š / æ‰‹æ©Ÿ â€“ å’Œæ½¤ */
  {
    id: "hr_car_4p2",
    name: "å’Œæ½¤ æ±½è»ŠåŸè/æ©Ÿè»ŠåŸè 4+2 å°ˆæ¡ˆ",
    company: "å’Œæ½¤",
    type: "æ±½è»Š",
    level: "å„ªè³ª",
    preferLevel: "normal",
    minAge: 20,
    maxAge: 70,
    needCar: true,
    needPayroll: false,
    needLabor: false,
    minScore: 560,
    minIncome: 25000,
    tags: ["æ±½è»Šè²¸", "åŸè»Šèè³‡", "ä»–è¡Œä»£å„Ÿ"],
    rate: "ç´„ 8.5%~16%",
    terms: "12~84 æœŸ",
    note: "åä¸‹æœ‰æ±½è»Šå³å¯è©•ä¼°ï¼Œå¯åšä»–è¡Œä»£å„Ÿæˆ–å¢è²¸ï¼Œé¡åº¦è¼ƒå½ˆæ€§ã€‚",
  },
  {
    id: "hr_bike",
    name: "å’Œæ½¤ æ©Ÿè»ŠåŸè ä¸€èˆ¬/è¶…U",
    company: "å’Œæ½¤",
    type: "æ©Ÿè»Š",
    level: "ä¸€èˆ¬",
    preferLevel: "normal",
    minAge: 20,
    maxAge: 70,
    needBike: true,
    minScore: 540,
    minIncome: 20000,
    tags: ["æ©Ÿè»Šè²¸", "åŸè»Šèè³‡"],
    rate: "ç´„ 8.5%~16%",
    terms: "12~60 æœŸ",
    note: "åä¸‹æœ‰æ©Ÿè»Šå³å¯è©•ä¼°ï¼ŒèˆŠä»¶å¯ä»£å„Ÿé‡æ–°æ‹‰é•·æœŸæ•¸ã€é™æœˆä»˜ã€‚",
  },

  /* äºå¤ª â€“ æ‰‹æ©Ÿ / æ©Ÿè»Š / å·¥æœƒ */
  {
    id: "yt_phone",
    name: "äºå¤ª æ‰‹æ©Ÿå¿«é€Ÿè²¸åˆ†æœŸå°ˆæ¡ˆ",
    company: "äºå¤ª",
    type: "æ‰‹æ©Ÿ",
    level: "å„ªè³ª",
    preferLevel: "normal",
    minAge: 20,
    maxAge: 60,
    needPayroll: true,
    needLabor: true,
    minScore: 560,
    minIncome: 25000,
    tags: ["æ‰‹æ©Ÿè²¸", "åˆ†æœŸ", "é™„å•†å“ç…§ + IMEI"],
    rate: "ä¾è¡¨åˆ—ï¼Œå…§æ”¶æ‰‹çºŒè²»",
    terms: "24 æœŸ",
    note: "åä¸‹æœ‰æ™ºæ…§å‹æ‰‹æ©Ÿï¼‹åœ¨è·åŠå¹´ä»¥ä¸Šä¸”æœ‰æŠ•ä¿ï¼Œå¯ç•¶å°é¡ä¿¡è²¸å‘¨è½‰ã€‚",
  },
  {
    id: "yt_bike_union",
    name: "äºå¤ª ä¸€èˆ¬å•†å“(å«æ©Ÿè»Š)åˆ†æœŸ-è·æ¥­å·¥æœƒå°ˆæ¡ˆ",
    company: "äºå¤ª",
    type: "æ©Ÿè»Š",
    level: "ä¸€èˆ¬",
    preferLevel: "normal",
    minAge: 20,
    maxAge: 45,
    needPayroll: false,
    needLabor: false,
    needBike: true,
    isUnion: true,
    minScore: 540,
    minIncome: 22000,
    tags: ["å·¥æœƒ", "æ©Ÿè»Š", "ä¸€èˆ¬å•†å“åˆ†æœŸ"],
    rate: "ä¾å°ˆæ¡ˆè¡¨åˆ—",
    terms: "24 æœŸ",
    note: "æŠ•ä¿è·æ¥­å·¥æœƒè€…é©ç”¨ï¼Œæ–‡ä»¶ç°¡å–®ï¼Œé©åˆä½œç‚ºå°é¡å‘¨è½‰ã€‚",
  },

  /* é¼ä¿¡ â€“ æ‰‹æ©Ÿè²¬ä¿¡ / éŠ€è¡Œä¿¡è²¸ä»²ä»‹ */
  {
    id: "dx_phone_credit",
    name: "é¼ä¿¡ æ‰‹æ©Ÿè²¬ä¿¡è²¸å°ˆæ¡ˆ",
    company: "é¼ä¿¡",
    type: "æ‰‹æ©Ÿ",
    level: "ä¸€èˆ¬",
    preferLevel: "weak",
    minAge: 20,
    maxAge: 60,
    needPayroll: false,
    needLabor: false,
    minScore: 0,
    minIncome: 0,
    tags: ["æ‰‹æ©Ÿè²¬ä»»", "ä»£å„Ÿ", "è¼ƒå¯¬é¬†"],
    rate: "ä¾å€‹æ¡ˆè©•ä¼°",
    terms: "ä¾æ‰‹æ©Ÿåˆ†æœŸ",
    note: "é©åˆç„¡æ³•èµ°ä¸€èˆ¬éŠ€è¡Œ/é›»ä¿¡é€šè·¯çš„å®¢æˆ¶ï¼Œæ¢ä»¶è¼ƒå¯¬é¬†ä½†æ‰‹çºŒè²»è¼ƒé«˜ã€‚",
  },
  {
    id: "dx_bank_personal",
    name: "é¼ä¿¡ éŠ€è¡Œä¿¡è²¸å°ˆæ¡ˆï¼ˆé…å°å¤šå®¶éŠ€è¡Œï¼‰",
    company: "é¼ä¿¡",
    type: "ä¿¡è²¸",
    level: "å„ªè³ª",
    preferLevel: "top",
    minAge: 20,
    maxAge: 70,
    needPayroll: true,
    needLabor: true,
    minScore: 620,
    minIncome: 32000,
    tags: ["éŠ€è¡Œä¿¡è²¸", "å¤šå®¶æ¯”åƒ¹"],
    rate: "ä¾å„éŠ€è¡Œ",
    terms: "æœ€é•· 84 æœŸ",
    note: "ç¬¦åˆéŠ€è¡Œä»¶æ¢ä»¶æ™‚ï¼Œå„ªå…ˆé…å°åˆ©ç‡ä½ã€é¡åº¦é«˜çš„éŠ€è¡Œä¿¡è²¸ã€‚",
  },

  /* å‰µé‰… / æ‰‹æ©Ÿ & æ©Ÿè»Š */
  {
    id: "cj_phone",
    name: "å‰µé‰… æ‰‹æ©Ÿè²¸æ¬¾å°ˆæ¡ˆ",
    company: "å‰µé‰…",
    type: "æ‰‹æ©Ÿ",
    level: "ä¸€èˆ¬",
    preferLevel: "normal",
    minAge: 20,
    maxAge: 60,
    needPayroll: false,
    needLabor: false,
    minScore: 0,
    minIncome: 0,
    tags: ["æ‰‹æ©Ÿè²¸", "å‹è™Ÿæ¸…å–®", "å›ºå®šæ‰‹çºŒè²»"],
    rate: "ä¾è¡¨åˆ—",
    terms: "48 æœŸ",
    note: "æŒ‡å®šæ‰‹æ©Ÿå‹è™Ÿå¯è¾¦ï¼Œæ‰‹çºŒè²»å›ºå®š 2000 å…§æ‰£ï¼Œé©åˆå°é¡åˆ†æœŸå‘¨è½‰ã€‚",
  },
  {
    id: "cj_bike",
    name: "å‰µé‰… æ©Ÿè»Šè²¸æ¬¾å°ˆæ¡ˆ",
    company: "å‰µé‰…",
    type: "æ©Ÿè»Š",
    level: "ä¸€èˆ¬",
    preferLevel: "normal",
    minAge: 20,
    maxAge: 60,
    needBike: true,
    minScore: 0,
    minIncome: 0,
    tags: ["æ©Ÿè»Šè²¸", "å›ºå®šè¨­å®šè²»+æ‰‹çºŒè²»"],
    rate: "ä¾è¡¨åˆ—",
    terms: "48 æœŸ",
    note: "åä¸‹æœ‰æ©Ÿè»Šå³å¯ï¼Œè¨­å®šè²»+æ‰‹çºŒè²»åˆè¨ˆç´„ 3000ï¼Œæœ€é«˜ç´„ 10 è¬ã€‚",
  },
];

/* å¯è¾¦ç†é¡å‹èˆ‡å…¬å¸é¸é … */
const TYPE_OPTIONS = ["æˆ¿è²¸", "ä¿¡è²¸", "æ±½è»Š", "æ©Ÿè»Š", "æ‰‹æ©Ÿ", "äºŒèƒ"];
const COMPANY_OPTIONS = ["å’Œæ½¤", "äºå¤ª", "é¼ä¿¡", "æ–°é‘«", "å‰µé‰…"];

/* =========================
   2. UI åˆå§‹åŒ–
   ========================= */

const $ = (sel) => document.querySelector(sel);

function createChips(containerId, items, namePrefix) {
  const container = $(containerId);
  container.innerHTML = "";
  items.forEach((text) => {
    const chip = document.createElement("button");
    chip.type = "button";
    chip.className = "chip";
    chip.dataset.value = text;
    chip.dataset.group = namePrefix;
    chip.textContent = text;
    chip.addEventListener("click", () => {
      chip.classList.toggle("active");
    });
    container.appendChild(chip);
  });
}

createChips("#typeChips", TYPE_OPTIONS, "type");
createChips("#companyChips", COMPANY_OPTIONS, "company");

/* =========================
   3. AI æ¨è–¦é‚è¼¯ (v5+v6)
   ========================= */

function getClientInput() {
  const age = parseFloat($("#age").value) || null;
  const income = parseFloat($("#income").value) || null;
  const score = parseFloat($("#score").value) || null;
  const years = parseFloat($("#years").value) || null;
  const creditStatus = $("#creditStatus").value || "";

  const hasPayroll = $("#hasPayroll").checked;
  const hasLabor = $("#hasLabor").checked;
  const hasHouse = $("#hasHouse").checked;
  const hasCar = $("#hasCar").checked;
  const hasBike = $("#hasBike").checked;
  const isUnion = $("#isUnion").checked;

  const selectedTypes = [...document.querySelectorAll('#typeChips .chip.active')].map(
    (c) => c.dataset.value
  );
  const selectedCompanies = [
    ...document.querySelectorAll("#companyChips .chip.active"),
  ].map((c) => c.dataset.value);

  return {
    age,
    income,
    score,
    years,
    creditStatus,
    hasPayroll,
    hasLabor,
    hasHouse,
    hasCar,
    hasBike,
    isUnion,
    selectedTypes,
    selectedCompanies,
  };
}

/* è¨ˆç®—å–®ä¸€å°ˆæ¡ˆé©é…åˆ†æ•¸ */
function scoreProject(p, c) {
  let score = 0;
  const reasons = [];

  /* å¹´é½¡ */
  if (c.age !== null) {
    if (c.age < (p.minAge || 0) || c.age > (p.maxAge || 99)) {
      reasons.push("å¹´é½¡ä¸åœ¨å°ˆæ¡ˆè¦å®šç¯„åœå…§");
      return { ok: false, score: -999, reasons };
    } else {
      score += 5;
    }
  }

  /* æ”¶å…¥ */
  if (c.income !== null && p.minIncome) {
    if (c.income < p.minIncome) {
      reasons.push(`æ”¶å…¥éœ€è‡³å°‘ç´„ ${p.minIncome.toLocaleString()} å…ƒ`);
      return { ok: false, score: -999, reasons };
    } else {
      score += 5;
    }
  }

  /* è¯å¾µåˆ†æ•¸ */
  if (c.score !== null && p.minScore) {
    if (c.score < p.minScore) {
      reasons.push(`å»ºè­°åˆ†æ•¸éœ€ ${p.minScore}+`);
      return { ok: false, score: -999, reasons };
    } else {
      score += 5;
    }
  }

  /* åœ¨è·å¹´è³‡ */
  if (c.years !== null && c.years >= 1) score += 3;
  if (c.years !== null && c.years >= 3) score += 2;

  /* å¿…è¦è³‡ç”¢æ¢ä»¶ */
  if (p.needHouse && !c.hasHouse) {
    reasons.push("æ­¤å°ˆæ¡ˆéœ€åä¸‹æœ‰æˆ¿");
    return { ok: false, score: -999, reasons };
  }
  if (p.needCar && !c.hasCar) {
    reasons.push("æ­¤å°ˆæ¡ˆéœ€åä¸‹æœ‰æ±½è»Š");
    return { ok: false, score: -999, reasons };
  }
  if (p.needBike && !c.hasBike) {
    reasons.push("æ­¤å°ˆæ¡ˆéœ€åä¸‹æœ‰æ©Ÿè»Š");
    return { ok: false, score: -999, reasons };
  }
  if (p.needPayroll && !c.hasPayroll) {
    reasons.push("å»ºè­°æœ‰è–ªè½‰è¼ƒé©åˆæ­¤å°ˆæ¡ˆ");
  } else if (p.needPayroll && c.hasPayroll) {
    score += 4;
  }
  if (p.needLabor && !c.hasLabor) {
    reasons.push("å»ºè­°æœ‰å‹ä¿ / å¥ä¿è¼ƒä½³");
  } else if (p.needLabor && c.hasLabor) {
    score += 3;
  }
  if (p.isUnion && !c.isUnion) {
    reasons.push("æ­¤å°ˆæ¡ˆéœ€å·¥æœƒæŠ•ä¿");
    return { ok: false, score: -999, reasons };
  }

  /* ä¿¡ç”¨ç­‰ç´šåå¥½ */
  if (p.preferLevel === "top" && c.creditStatus === "top") score += 6;
  if (p.preferLevel === "top" && c.creditStatus === "normal") score += 3;
  if (p.preferLevel === "normal" && c.creditStatus === "normal") score += 4;
  if (p.preferLevel === "normal" && c.creditStatus === "weak") score += 2;
  if (p.preferLevel === "weak" && (c.creditStatus === "weak" || c.creditStatus === "bad"))
    score += 5;

  /* é¡å‹åå¥½ */
  if (c.selectedTypes.length && c.selectedTypes.includes(p.type)) {
    score += 4;
  } else if (!c.selectedTypes.length) {
    score += 1; // æ²’é¸é¡å‹å‰‡è¼•å¾®åŠ åˆ†
  }

  /* å…¬å¸ç¯©é¸ï¼šåªé¸ç‰¹å®šå…¬å¸æ™‚ */
  if (c.selectedCompanies.length && !c.selectedCompanies.includes(p.company)) {
    return { ok: false, score: -999, reasons: ["æœªåœ¨å‹¾é¸çš„å…¬å¸ç¯„åœå…§"] };
  }

  /* é¡å¤–å°åŠ æˆï¼šæœ‰æˆ¿/è»Š/æ©Ÿè»Š + å°æ‡‰å°ˆæ¡ˆ */
  if (p.type === "æˆ¿è²¸" && c.hasHouse) score += 2;
  if (p.type === "äºŒèƒ" && c.hasHouse) score += 3;
  if (p.type === "æ±½è»Š" && c.hasCar) score += 2;
  if (p.type === "æ©Ÿè»Š" && c.hasBike) score += 2;

  if (!reasons.length) {
    reasons.push("æ¢ä»¶å¤§è‡´ç¬¦åˆï¼Œå¯æ­£å¸¸é€ä»¶è©•ä¼°ã€‚");
  }

  return { ok: true, score, reasons };
}

function generateRecommendation() {
  const c = getClientInput();
  const scored = [];

  for (const p of projects) {
    const r = scoreProject(p, c);
    if (!r.ok) continue;
    scored.push({
      project: p,
      score: r.score,
      reasons: r.reasons,
    });
  }

  scored.sort((a, b) => b.score - a.score);

  const best = scored.filter((x) => x.score >= 15);
  const backup = scored.filter((x) => x.score >= 8 && x.score < 15);

  renderResults(best, backup, scored);
  updateSummary(c, best, backup, scored);
}

/* =========================
   4. çµæœé¡¯ç¤º & Tab åˆ‡æ›
   ========================= */

const tabContent = $("#tabContent");
const summaryText = $("#summaryText");

function projectCardHTML(item, categoryLabel) {
  const p = item.project;
  const levelClass = p.level === "å„ªè³ª" ? "level-top" : "";
  const tagsHtml = (p.tags || [])
    .map((t) => `<span class="tag">${t}</span>`)
    .join("");

  const reasonText = item.reasons ? item.reasons.join("ï¼›") : "";

  return `
    <div class="project-card">
      <div class="project-header">
        <div>
          <div class="project-title">${p.name}</div>
          <div class="project-meta">
            <span>ğŸ“Œ å…¬å¸ï¼š${p.company}</span>
            <span>ğŸ“‚ é¡åˆ¥ï¼š${p.type}</span>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
          <div class="badge-level ${levelClass}">${p.level}å®¢ç¾¤</div>
          ${
            categoryLabel
              ? `<div class="tag tag-primary">${categoryLabel}</div>`
              : ""
          }
        </div>
      </div>
      <div class="project-meta">
        <span>ğŸ’° åˆ©ç‡ï¼š${p.rate}</span>
        <span>ğŸ“† æœŸæ•¸ï¼š${p.terms}</span>
      </div>
      <div class="section-title">æ¢ä»¶é‡é»</div>
      <div class="project-meta">
        ${
          p.needHouse
            ? `<span>ğŸ  éœ€åä¸‹æœ‰æˆ¿</span>`
            : ""
        }
        ${
          p.needCar
            ? `<span>ğŸš— éœ€åä¸‹æœ‰æ±½è»Š</span>`
            : ""
        }
        ${
          p.needBike
            ? `<span>ğŸ›µ éœ€åä¸‹æœ‰æ©Ÿè»Š</span>`
            : ""
        }
        ${
          p.needPayroll
            ? `<span>ğŸ’³ å»ºè­°æœ‰è–ªè½‰</span>`
            : ""
        }
        ${
          p.needLabor
            ? `<span>ğŸ©º å»ºè­°æœ‰å‹/å¥ä¿</span>`
            : ""
        }
        ${
          p.isUnion
            ? `<span>ğŸ‘· éœ€è·æ¥­å·¥æœƒ</span>`
            : ""
        }
      </div>
      <div class="section-title">ç³»çµ±èªªæ˜</div>
      <div class="reason">${reasonText}</div>
      ${
        p.note
          ? `<div class="section-title">æ“ä½œè€…å‚™è¨»</div><div class="project-meta">${p.note}</div>`
          : ""
      }
      <div style="margin-top:4px;">${tagsHtml}</div>
    </div>
  `;
}

function renderResults(best, backup, allScored) {
  const allListHtml = allScored
    .map((item) => projectCardHTML(item, "å…¨éƒ¨å°ˆæ¡ˆ"))
    .join("");

  const bestHtml =
    best.length > 0
      ? best.map((item) => projectCardHTML(item, "â­ å„ªå…ˆæ¨è–¦")).join("")
      : `<div class="empty">ç›®å‰æ²’æœ‰åˆ†æ•¸ç‰¹åˆ¥é«˜çš„å°ˆæ¡ˆï¼Œå¯ä»¥æ”¹æ”¾å¯¬æ¢ä»¶æˆ–æ”¹é¸ã€Œå…¨éƒ¨å°ˆæ¡ˆåˆ—è¡¨ã€æŸ¥çœ‹ã€‚</div>`;

  const backupHtml =
    backup.length > 0
      ? backup
          .map((item) => projectCardHTML(item, "âœ… å¯å‚™é¸"))
          .join("")
      : `<div class="empty">ç›®å‰æ²’æœ‰å‚™é¸å°ˆæ¡ˆï¼Œå»ºè­°èª¿æ•´é¡å‹æˆ–å…¬å¸ç¯©é¸æ¢ä»¶ã€‚</div>`;

  tabContent.dataset.best = bestHtml;
  tabContent.dataset.backup = backupHtml;
  tabContent.dataset.all = allListHtml || `<div class="empty">ç›®å‰å°šç„¡ç¬¦åˆæ¢ä»¶çš„å°ˆæ¡ˆï¼Œè«‹æ”¾å¯¬æ¢ä»¶æˆ–å¢åŠ å°ˆæ¡ˆè³‡æ–™ã€‚</div>`;

  // é è¨­é¡¯ç¤ºæœ€ä½³æ¨è–¦
  tabContent.innerHTML = tabContent.dataset.best;
}

function updateSummary(c, best, backup, allScored) {
  const total = allScored.length;
  const bestCount = best.length;
  const backupCount = backup.length;

  let summary = `å·²ä¾ç…§ç›®å‰è¼¸å…¥æ¢ä»¶ï¼Œç‚ºä½ å¾ ${projects.length} å€‹å°ˆæ¡ˆä¸­ç¯©å‡º ${total} å€‹å¯é€ä»¶è©•ä¼°çš„æ–¹æ¡ˆã€‚`;
  if (bestCount) {
    summary += ` å…¶ä¸­ ${bestCount} å€‹ç‚ºã€Œå„ªå…ˆæ¨è–¦ã€ï¼Œ${backupCount} å€‹ç‚ºã€Œå‚™é¸ã€ã€‚`;
  } else if (backupCount) {
    summary += ` ç›®å‰æ²’æœ‰åˆ†æ•¸éå¸¸é«˜çš„å°ˆæ¡ˆï¼Œä½†æœ‰ ${backupCount} å€‹ã€Œå‚™é¸ã€å¯åƒè€ƒã€‚`;
  } else {
    summary = "ç›®å‰æ¢ä»¶è¼ƒåš´æ ¼ï¼Œå°šæœªæ‰¾åˆ°æ˜é¡¯åˆé©å°ˆæ¡ˆï¼Œå¯æ”¾å¯¬å…¬å¸æˆ–å°ˆæ¡ˆé¡å‹å¾Œé‡è©¦ã€‚";
  }

  summaryText.textContent = summary;
}

/* Tab åˆ‡æ› */
document.querySelectorAll("#resultTabs .tab").forEach((tab) => {
  tab.addEventListener("click", () => {
    document
      .querySelectorAll("#resultTabs .tab")
      .forEach((t) => t.classList.remove("active"));
    tab.classList.add("active");
    const target = tab.dataset.tab;
    tabContent.innerHTML = tabContent.dataset[target] || "";
  });
});

/* =========================
   5. è¨ˆç®—æ©ŸåŠŸèƒ½ (v7)
   ========================= */

function calcEqualPayment() {
  const amount = parseFloat($("#calcAmount").value);
  const months = parseInt($("#calcMonths").value, 10);
  const rate = parseFloat($("#calcRate").value);

  if (!amount || !months || !rate) {
    $("#calcPayResult").textContent = "è«‹å…ˆè¼¸å…¥é‡‘é¡ã€æœŸæ•¸èˆ‡å¹´åˆ©ç‡ã€‚";
    return;
  }

  const monthlyRate = rate / 100 / 12;
  const payment =
    (amount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -months));
  const total = payment * months;

  $("#calcPayResult").textContent = `æ¯æœˆç´„éœ€ç¹³ï¼š${Math.round(
    payment
  ).toLocaleString()} å…ƒï¼Œç¸½é‚„æ¬¾ç´„ï¼š${Math.round(total).toLocaleString()} å…ƒã€‚`;
}

function calcSecondLoan() {
  const houseValue = parseFloat($("#houseValue").value);
  const firstLoan = parseFloat($("#firstLoan").value);
  const maxLtv = parseFloat($("#maxLtv").value);

  if (!houseValue || maxLtv == null) {
    $("#calcSecondResult").textContent = "è«‹å…ˆè¼¸å…¥æˆ¿å±‹ä¼°åƒ¹èˆ‡æœ€é«˜æˆæ•¸ã€‚";
    return;
  }

  const maxTotal = (houseValue * maxLtv) / 100;
  const remain = maxTotal - (firstLoan || 0);

  if (remain <= 0) {
    $("#calcSecondResult").textContent =
      "ä»¥ç›®å‰è¨­å®šä¸€èƒé¤˜é¡èˆ‡æˆæ•¸ï¼Œç†è«–ä¸Šç©ºé–“ä¸è¶³ä»¥åšäºŒèƒã€‚";
  } else {
    $("#calcSecondResult").textContent = `æ¦‚ç®—å¯æ“ä½œäºŒèƒé¡åº¦ç´„ï¼š${Math.round(
      remain
    ).toLocaleString()} å…ƒï¼ˆå¯¦éš›ä»¥ä¼°åƒ¹èˆ‡å…¬å¸å¯©æ ¸ç‚ºæº–ï¼‰ã€‚`;
  }
}

/* =========================
   6. äº‹ä»¶ç¶å®š & é‡ç½®
   ========================= */

$("#btnRecommend").addEventListener("click", generateRecommendation);
$("#btnCalcPay").addEventListener("click", calcEqualPayment);
$("#btnCalcSecond").addEventListener("click", calcSecondLoan);

$("#btnReset").addEventListener("click", () => {
  ["age","income","score","years"].forEach(id => { $( "#" + id ).value = ""; });
  ["hasPayroll","hasLabor","hasHouse","hasCar","hasBike","isUnion"].forEach(
    (id) => { $("#" + id).checked = false; }
  );
  $("#creditStatus").value = "";
  document.querySelectorAll(".chip.active").forEach((c) => c.classList.remove("active"));
  summaryText.textContent = "æ¢ä»¶å·²æ¸…ç©ºï¼Œè«‹é‡æ–°è¼¸å…¥å¾Œå†æŒ‰ã€Œç”¢ç”Ÿ AI æ¨è–¦ã€ã€‚";
  tabContent.innerHTML =
    '<div class="empty">å°šæœªç”¢ç”Ÿçµæœï¼Œè«‹å…ˆæ–¼å·¦å´è¼¸å…¥å®¢æˆ¶æ¢ä»¶ä¸¦ç”¢ç”Ÿæ¨è–¦ã€‚</div>';
});

/* åˆå§‹ç•«é¢é è¨­æ–‡æ¡ˆ */
tabContent.innerHTML =
  '<div class="empty">å°šæœªç”¢ç”Ÿçµæœï¼Œè«‹å…ˆæ–¼å·¦å´è¼¸å…¥å®¢æˆ¶æ¢ä»¶ä¸¦æŒ‰ã€Œç”¢ç”Ÿ AI æ¨è–¦ã€ã€‚</div>';
</script>
</body>
</html>
